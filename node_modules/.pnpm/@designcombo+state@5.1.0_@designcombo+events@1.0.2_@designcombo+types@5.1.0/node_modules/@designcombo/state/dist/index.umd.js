(function(S,H){typeof exports=="object"&&typeof module<"u"?H(exports,require("@designcombo/events")):typeof define=="function"&&define.amd?define(["exports","@designcombo/events"],H):(S=typeof globalThis<"u"?globalThis:S||self,H(S.events={},S.events))})(this,function(S,H){"use strict";var zo=Object.defineProperty;var No=(S,H,Pt)=>H in S?zo(S,H,{enumerable:!0,configurable:!0,writable:!0,value:Pt}):S[H]=Pt;var Yt=(S,H,Pt)=>No(S,typeof H!="symbol"?H+"":H,Pt);var Pt=function(t,r){return Pt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])},Pt(t,r)};function Ne(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");Pt(t,r);function e(){this.constructor=t}t.prototype=r===null?Object.create(r):(e.prototype=r.prototype,new e)}function Rr(t){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&t[r],n=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}function Cr(t,r){var e=typeof Symbol=="function"&&t[Symbol.iterator];if(!e)return t;var n=e.call(t),i,o=[],c;try{for(;(r===void 0||r-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(u){c={error:u}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(c)throw c.error}}return o}function Pr(t,r,e){if(e||arguments.length===2)for(var n=0,i=r.length,o;n<i;n++)(o||!(n in r))&&(o||(o=Array.prototype.slice.call(r,0,n)),o[n]=r[n]);return t.concat(o||Array.prototype.slice.call(r))}typeof SuppressedError=="function"&&SuppressedError;function St(t){return typeof t=="function"}function jn(t){var r=function(n){Error.call(n),n.stack=new Error().stack},e=t(r);return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var xr=jn(function(t){return function(e){t(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function Lr(t,r){if(t){var e=t.indexOf(r);0<=e&&t.splice(e,1)}}var or=function(){function t(r){this.initialTeardown=r,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var r,e,n,i,o;if(!this.closed){this.closed=!0;var c=this._parentage;if(c)if(this._parentage=null,Array.isArray(c))try{for(var u=Rr(c),p=u.next();!p.done;p=u.next()){var h=p.value;h.remove(this)}}catch(_){r={error:_}}finally{try{p&&!p.done&&(e=u.return)&&e.call(u)}finally{if(r)throw r.error}}else c.remove(this);var m=this.initialTeardown;if(St(m))try{m()}catch(_){o=_ instanceof xr?_.errors:[_]}var y=this._finalizers;if(y){this._finalizers=null;try{for(var d=Rr(y),b=d.next();!b.done;b=d.next()){var T=b.value;try{Wn(T)}catch(_){o=o??[],_ instanceof xr?o=Pr(Pr([],Cr(o)),Cr(_.errors)):o.push(_)}}}catch(_){n={error:_}}finally{try{b&&!b.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}}if(o)throw new xr(o)}},t.prototype.add=function(r){var e;if(r&&r!==this)if(this.closed)Wn(r);else{if(r instanceof t){if(r.closed||r._hasParent(this))return;r._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(r)}},t.prototype._hasParent=function(r){var e=this._parentage;return e===r||Array.isArray(e)&&e.includes(r)},t.prototype._addParent=function(r){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(r),e):e?[e,r]:r},t.prototype._removeParent=function(r){var e=this._parentage;e===r?this._parentage=null:Array.isArray(e)&&Lr(e,r)},t.prototype.remove=function(r){var e=this._finalizers;e&&Lr(e,r),r instanceof t&&r._removeParent(this)},t.EMPTY=function(){var r=new t;return r.closed=!0,r}(),t}(),Bn=or.EMPTY;function Yn(t){return t instanceof or||t&&"closed"in t&&St(t.remove)&&St(t.add)&&St(t.unsubscribe)}function Wn(t){St(t)?t():t.unsubscribe()}var ki={Promise:void 0},vi={setTimeout:function(t,r){for(var e=[],n=2;n<arguments.length;n++)e[n-2]=arguments[n];return setTimeout.apply(void 0,Pr([t,r],Cr(e)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function Si(t){vi.setTimeout(function(){throw t})}function Gn(){}function cr(t){t()}var Xn=function(t){Ne(r,t);function r(e){var n=t.call(this)||this;return n.isStopped=!1,e?(n.destination=e,Yn(e)&&e.add(n)):n.destination=Ai,n}return r.create=function(e,n,i){return new zr(e,n,i)},r.prototype.next=function(e){this.isStopped||this._next(e)},r.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},r.prototype._next=function(e){this.destination.next(e)},r.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},r.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},r}(or),Ei=function(){function t(r){this.partialObserver=r}return t.prototype.next=function(r){var e=this.partialObserver;if(e.next)try{e.next(r)}catch(n){ur(n)}},t.prototype.error=function(r){var e=this.partialObserver;if(e.error)try{e.error(r)}catch(n){ur(n)}else ur(r)},t.prototype.complete=function(){var r=this.partialObserver;if(r.complete)try{r.complete()}catch(e){ur(e)}},t}(),zr=function(t){Ne(r,t);function r(e,n,i){var o=t.call(this)||this,c;return St(e)||!e?c={next:e??void 0,error:n??void 0,complete:i??void 0}:c=e,o.destination=new Ei(c),o}return r}(Xn);function ur(t){Si(t)}function Ti(t){throw t}var Ai={closed:!0,next:Gn,error:Ti,complete:Gn},wi=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Mi(t){return t}function Oi(t){return t.length===0?Mi:t.length===1?t[0]:function(e){return t.reduce(function(n,i){return i(n)},e)}}var Kn=function(){function t(r){r&&(this._subscribe=r)}return t.prototype.lift=function(r){var e=new t;return e.source=this,e.operator=r,e},t.prototype.subscribe=function(r,e,n){var i=this,o=Ri(r)?r:new zr(r,e,n);return cr(function(){var c=i,u=c.operator,p=c.source;o.add(u?u.call(o,p):p?i._subscribe(o):i._trySubscribe(o))}),o},t.prototype._trySubscribe=function(r){try{return this._subscribe(r)}catch(e){r.error(e)}},t.prototype.forEach=function(r,e){var n=this;return e=Vn(e),new e(function(i,o){var c=new zr({next:function(u){try{r(u)}catch(p){o(p),c.unsubscribe()}},error:o,complete:i});n.subscribe(c)})},t.prototype._subscribe=function(r){var e;return(e=this.source)===null||e===void 0?void 0:e.subscribe(r)},t.prototype[wi]=function(){return this},t.prototype.pipe=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return Oi(r)(this)},t.prototype.toPromise=function(r){var e=this;return r=Vn(r),new r(function(n,i){var o;e.subscribe(function(c){return o=c},function(c){return i(c)},function(){return n(o)})})},t.create=function(r){return new t(r)},t}();function Vn(t){var r;return(r=t??ki.Promise)!==null&&r!==void 0?r:Promise}function Di(t){return t&&St(t.next)&&St(t.error)&&St(t.complete)}function Ri(t){return t&&t instanceof Xn||Di(t)&&Yn(t)}var Ci=jn(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Jn=function(t){Ne(r,t);function r(){var e=t.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return r.prototype.lift=function(e){var n=new qn(this,this);return n.operator=e,n},r.prototype._throwIfClosed=function(){if(this.closed)throw new Ci},r.prototype.next=function(e){var n=this;cr(function(){var i,o;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var c=Rr(n.currentObservers),u=c.next();!u.done;u=c.next()){var p=u.value;p.next(e)}}catch(h){i={error:h}}finally{try{u&&!u.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}}})},r.prototype.error=function(e){var n=this;cr(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=e;for(var i=n.observers;i.length;)i.shift().error(e)}})},r.prototype.complete=function(){var e=this;cr(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var n=e.observers;n.length;)n.shift().complete()}})},r.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(r.prototype,"observed",{get:function(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0},enumerable:!1,configurable:!0}),r.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},r.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},r.prototype._innerSubscribe=function(e){var n=this,i=this,o=i.hasError,c=i.isStopped,u=i.observers;return o||c?Bn:(this.currentObservers=null,u.push(e),new or(function(){n.currentObservers=null,Lr(u,e)}))},r.prototype._checkFinalizedStatuses=function(e){var n=this,i=n.hasError,o=n.thrownError,c=n.isStopped;i?e.error(o):c&&e.complete()},r.prototype.asObservable=function(){var e=new Kn;return e.source=this,e},r.create=function(e,n){return new qn(e,n)},r}(Kn),qn=function(t){Ne(r,t);function r(e,n){var i=t.call(this)||this;return i.destination=e,i.source=n,i}return r.prototype.next=function(e){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.next)===null||i===void 0||i.call(n,e)},r.prototype.error=function(e){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.error)===null||i===void 0||i.call(n,e)},r.prototype.complete=function(){var e,n;(n=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||n===void 0||n.call(e)},r.prototype._subscribe=function(e){var n,i;return(i=(n=this.source)===null||n===void 0?void 0:n.subscribe(e))!==null&&i!==void 0?i:Bn},r}(Jn),Zn=function(t){Ne(r,t);function r(e){var n=t.call(this)||this;return n._value=e,n}return Object.defineProperty(r.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),r.prototype._subscribe=function(e){var n=t.prototype._subscribe.call(this,e);return!n.closed&&e.next(this._value),n},r.prototype.getValue=function(){var e=this,n=e.hasError,i=e.thrownError,o=e._value;if(n)throw i;return this._throwIfClosed(),o},r.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},r}(Jn),pt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Nr(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var lr={exports:{}};lr.exports,function(t,r){var e=200,n="__lodash_hash_undefined__",i=1,o=2,c=9007199254740991,u="[object Arguments]",p="[object Array]",h="[object AsyncFunction]",m="[object Boolean]",y="[object Date]",d="[object Error]",b="[object Function]",T="[object GeneratorFunction]",_="[object Map]",E="[object Number]",f="[object Null]",I="[object Object]",k="[object Promise]",v="[object Proxy]",w="[object RegExp]",M="[object Set]",A="[object String]",j="[object Symbol]",P="[object Undefined]",Z="[object WeakMap]",D="[object ArrayBuffer]",F="[object DataView]",nt="[object Float32Array]",Zt="[object Float64Array]",Qt="[object Int8Array]",be="[object Int16Array]",_e="[object Int32Array]",ke="[object Uint8Array]",ve="[object Uint8ClampedArray]",z="[object Uint16Array]",Se="[object Uint32Array]",Ee=/[\\^$.*+?()[\]{}|]/g,at=/^\[object .+?Constructor\]$/,te=/^(?:0|[1-9]\d*)$/,N={};N[nt]=N[Zt]=N[Qt]=N[be]=N[_e]=N[ke]=N[ve]=N[z]=N[Se]=!0,N[u]=N[p]=N[D]=N[m]=N[F]=N[y]=N[d]=N[b]=N[_]=N[E]=N[I]=N[w]=N[M]=N[A]=N[Z]=!1;var ee=typeof pt=="object"&&pt&&pt.Object===Object&&pt,Te=typeof self=="object"&&self&&self.Object===Object&&self,ot=ee||Te||Function("return this")(),re=r&&!r.nodeType&&r,ne=re&&!0&&t&&!t.nodeType&&t,Lt=ne&&ne.exports===re,zt=Lt&&ee.process,se=function(){try{return zt&&zt.binding&&zt.binding("util")}catch{}}(),Nt=se&&se.isTypedArray;function ie(s,a){for(var l=-1,g=s==null?0:s.length,R=0,O=[];++l<g;){var L=s[l];a(L,l,s)&&(O[R++]=L)}return O}function Ft(s,a){for(var l=-1,g=a.length,R=s.length;++l<g;)s[R+l]=a[l];return s}function ae(s,a){for(var l=-1,g=s==null?0:s.length;++l<g;)if(a(s[l],l,s))return!0;return!1}function Ae(s,a){for(var l=-1,g=Array(s);++l<s;)g[l]=a(l);return g}function we(s){return function(a){return s(a)}}function Tt(s,a){return s.has(a)}function $t(s,a){return s==null?void 0:s[a]}function oe(s){var a=-1,l=Array(s.size);return s.forEach(function(g,R){l[++a]=[R,g]}),l}function ce(s,a){return function(l){return s(a(l))}}function ft(s){var a=-1,l=Array(s.size);return s.forEach(function(g){l[++a]=g}),l}var At=Array.prototype,Me=Function.prototype,bt=Object.prototype,wt=ot["__core-js_shared__"],Ht=Me.toString,st=bt.hasOwnProperty,ue=function(){var s=/[^.]+$/.exec(wt&&wt.keys&&wt.keys.IE_PROTO||"");return s?"Symbol(src)_1."+s:""}(),le=bt.toString,Oe=RegExp("^"+Ht.call(st).replace(Ee,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ut=Lt?ot.Buffer:void 0,Mt=ot.Symbol,Ir=ot.Uint8Array,De=bt.propertyIsEnumerable,de=At.splice,gt=Mt?Mt.toStringTag:void 0,Re=Object.getOwnPropertySymbols,Ve=Ut?Ut.isBuffer:void 0,fe=ce(Object.keys,Object),Je=Dt(ot,"DataView"),pe=Dt(ot,"Map"),qe=Dt(ot,"Promise"),Ze=Dt(ot,"Set"),Qe=Dt(ot,"WeakMap"),jt=Dt(Object,"create"),yr=it(Je),Ot=it(pe),sn=it(qe),an=it(Ze),on=it(Qe),br=Mt?Mt.prototype:void 0,tr=br?br.valueOf:void 0;function J(s){var a=-1,l=s==null?0:s.length;for(this.clear();++a<l;){var g=s[a];this.set(g[0],g[1])}}function cn(){this.__data__=jt?jt(null):{},this.size=0}function un(s){var a=this.has(s)&&delete this.__data__[s];return this.size-=a?1:0,a}function ln(s){var a=this.__data__;if(jt){var l=a[s];return l===n?void 0:l}return st.call(a,s)?a[s]:void 0}function dn(s){var a=this.__data__;return jt?a[s]!==void 0:st.call(a,s)}function fn(s,a){var l=this.__data__;return this.size+=this.has(s)?0:1,l[s]=jt&&a===void 0?n:a,this}J.prototype.clear=cn,J.prototype.delete=un,J.prototype.get=ln,J.prototype.has=dn,J.prototype.set=fn;function Q(s){var a=-1,l=s==null?0:s.length;for(this.clear();++a<l;){var g=s[a];this.set(g[0],g[1])}}function pn(){this.__data__=[],this.size=0}function hn(s){var a=this.__data__,l=xe(a,s);if(l<0)return!1;var g=a.length-1;return l==g?a.pop():de.call(a,l,1),--this.size,!0}function mn(s){var a=this.__data__,l=xe(a,s);return l<0?void 0:a[l][1]}function gn(s){return xe(this.__data__,s)>-1}function In(s,a){var l=this.__data__,g=xe(l,s);return g<0?(++this.size,l.push([s,a])):l[g][1]=a,this}Q.prototype.clear=pn,Q.prototype.delete=hn,Q.prototype.get=mn,Q.prototype.has=gn,Q.prototype.set=In;function ct(s){var a=-1,l=s==null?0:s.length;for(this.clear();++a<l;){var g=s[a];this.set(g[0],g[1])}}function yn(){this.size=0,this.__data__={hash:new J,map:new(pe||Q),string:new J}}function bn(s){var a=It(this,s).delete(s);return this.size-=a?1:0,a}function _n(s){return It(this,s).get(s)}function kn(s){return It(this,s).has(s)}function vn(s,a){var l=It(this,s),g=l.size;return l.set(s,a),this.size+=l.size==g?0:1,this}ct.prototype.clear=yn,ct.prototype.delete=bn,ct.prototype.get=_n,ct.prototype.has=kn,ct.prototype.set=vn;function Ce(s){var a=-1,l=s==null?0:s.length;for(this.__data__=new ct;++a<l;)this.add(s[a])}function _r(s){return this.__data__.set(s,n),this}function Pe(s){return this.__data__.has(s)}Ce.prototype.add=Ce.prototype.push=_r,Ce.prototype.has=Pe;function _t(s){var a=this.__data__=new Q(s);this.size=a.size}function er(){this.__data__=new Q,this.size=0}function Sn(s){var a=this.__data__,l=a.delete(s);return this.size=a.size,l}function En(s){return this.__data__.get(s)}function Tn(s){return this.__data__.has(s)}function An(s,a){var l=this.__data__;if(l instanceof Q){var g=l.__data__;if(!pe||g.length<e-1)return g.push([s,a]),this.size=++l.size,this;l=this.__data__=new ct(g)}return l.set(s,a),this.size=l.size,this}_t.prototype.clear=er,_t.prototype.delete=Sn,_t.prototype.get=En,_t.prototype.has=Tn,_t.prototype.set=An;function wn(s,a){var l=Le(s),g=!l&&Tr(s),R=!l&&!g&&ze(s),O=!l&&!g&&!R&&Mr(s),L=l||g||R||O,x=L?Ae(s.length,String):[],B=x.length;for(var $ in s)st.call(s,$)&&!(L&&($=="length"||R&&($=="offset"||$=="parent")||O&&($=="buffer"||$=="byteLength"||$=="byteOffset")||Ln($,B)))&&x.push($);return x}function xe(s,a){for(var l=s.length;l--;)if(Er(s[l][0],a))return l;return-1}function rr(s,a,l){var g=a(s);return Le(s)?g:Ft(g,l(s))}function he(s){return s==null?s===void 0?P:f:gt&&gt in Object(s)?Rt(s):Sr(s)}function kr(s){return vt(s)&&he(s)==u}function vr(s,a,l,g,R){return s===a?!0:s==null||a==null||!vt(s)&&!vt(a)?s!==s&&a!==a:Mn(s,a,l,g,vr,R)}function Mn(s,a,l,g,R,O){var L=Le(s),x=Le(a),B=L?p:kt(s),$=x?p:kt(a);B=B==u?I:B,$=$==u?I:$;var tt=B==I,ut=$==I,G=B==$;if(G&&ze(s)){if(!ze(a))return!1;L=!0,tt=!1}if(G&&!tt)return O||(O=new _t),L||Mr(s)?nr(s,a,l,g,R,O):Cn(s,a,B,l,g,R,O);if(!(l&i)){var et=tt&&st.call(s,"__wrapped__"),q=ut&&st.call(a,"__wrapped__");if(et||q){var Bt=et?s.value():s,Ct=q?a.value():a;return O||(O=new _t),R(Bt,Ct,l,g,O)}}return G?(O||(O=new _t),Pn(s,a,l,g,R,O)):!1}function On(s){if(!wr(s)||Nn(s))return!1;var a=Ar(s)?Oe:at;return a.test(it(s))}function Dn(s){return vt(s)&&ir(s.length)&&!!N[he(s)]}function Rn(s){if(!Fn(s))return fe(s);var a=[];for(var l in Object(s))st.call(s,l)&&l!="constructor"&&a.push(l);return a}function nr(s,a,l,g,R,O){var L=l&i,x=s.length,B=a.length;if(x!=B&&!(L&&B>x))return!1;var $=O.get(s);if($&&O.get(a))return $==a;var tt=-1,ut=!0,G=l&o?new Ce:void 0;for(O.set(s,a),O.set(a,s);++tt<x;){var et=s[tt],q=a[tt];if(g)var Bt=L?g(q,et,tt,a,s,O):g(et,q,tt,s,a,O);if(Bt!==void 0){if(Bt)continue;ut=!1;break}if(G){if(!ae(a,function(Ct,ge){if(!Tt(G,ge)&&(et===Ct||R(et,Ct,l,g,O)))return G.push(ge)})){ut=!1;break}}else if(!(et===q||R(et,q,l,g,O))){ut=!1;break}}return O.delete(s),O.delete(a),ut}function Cn(s,a,l,g,R,O,L){switch(l){case F:if(s.byteLength!=a.byteLength||s.byteOffset!=a.byteOffset)return!1;s=s.buffer,a=a.buffer;case D:return!(s.byteLength!=a.byteLength||!O(new Ir(s),new Ir(a)));case m:case y:case E:return Er(+s,+a);case d:return s.name==a.name&&s.message==a.message;case w:case A:return s==a+"";case _:var x=oe;case M:var B=g&i;if(x||(x=ft),s.size!=a.size&&!B)return!1;var $=L.get(s);if($)return $==a;g|=o,L.set(s,a);var tt=nr(x(s),x(a),g,R,O,L);return L.delete(s),tt;case j:if(tr)return tr.call(s)==tr.call(a)}return!1}function Pn(s,a,l,g,R,O){var L=l&i,x=me(s),B=x.length,$=me(a),tt=$.length;if(B!=tt&&!L)return!1;for(var ut=B;ut--;){var G=x[ut];if(!(L?G in a:st.call(a,G)))return!1}var et=O.get(s);if(et&&O.get(a))return et==a;var q=!0;O.set(s,a),O.set(a,s);for(var Bt=L;++ut<B;){G=x[ut];var Ct=s[G],ge=a[G];if(g)var _i=L?g(ge,Ct,G,a,s,O):g(Ct,ge,G,s,a,O);if(!(_i===void 0?Ct===ge||R(Ct,ge,l,g,O):_i)){q=!1;break}Bt||(Bt=G=="constructor")}if(q&&!Bt){var Or=s.constructor,Dr=a.constructor;Or!=Dr&&"constructor"in s&&"constructor"in a&&!(typeof Or=="function"&&Or instanceof Or&&typeof Dr=="function"&&Dr instanceof Dr)&&(q=!1)}return O.delete(s),O.delete(a),q}function me(s){return rr(s,ar,xn)}function It(s,a){var l=s.__data__;return zn(a)?l[typeof a=="string"?"string":"hash"]:l.map}function Dt(s,a){var l=$t(s,a);return On(l)?l:void 0}function Rt(s){var a=st.call(s,gt),l=s[gt];try{s[gt]=void 0;var g=!0}catch{}var R=le.call(s);return g&&(a?s[gt]=l:delete s[gt]),R}var xn=Re?function(s){return s==null?[]:(s=Object(s),ie(Re(s),function(a){return De.call(s,a)}))}:Hn,kt=he;(Je&&kt(new Je(new ArrayBuffer(1)))!=F||pe&&kt(new pe)!=_||qe&&kt(qe.resolve())!=k||Ze&&kt(new Ze)!=M||Qe&&kt(new Qe)!=Z)&&(kt=function(s){var a=he(s),l=a==I?s.constructor:void 0,g=l?it(l):"";if(g)switch(g){case yr:return F;case Ot:return _;case sn:return k;case an:return M;case on:return Z}return a});function Ln(s,a){return a=a??c,!!a&&(typeof s=="number"||te.test(s))&&s>-1&&s%1==0&&s<a}function zn(s){var a=typeof s;return a=="string"||a=="number"||a=="symbol"||a=="boolean"?s!=="__proto__":s===null}function Nn(s){return!!ue&&ue in s}function Fn(s){var a=s&&s.constructor,l=typeof a=="function"&&a.prototype||bt;return s===l}function Sr(s){return le.call(s)}function it(s){if(s!=null){try{return Ht.call(s)}catch{}try{return s+""}catch{}}return""}function Er(s,a){return s===a||s!==s&&a!==a}var Tr=kr(function(){return arguments}())?kr:function(s){return vt(s)&&st.call(s,"callee")&&!De.call(s,"callee")},Le=Array.isArray;function sr(s){return s!=null&&ir(s.length)&&!Ar(s)}var ze=Ve||Un;function $n(s,a){return vr(s,a)}function Ar(s){if(!wr(s))return!1;var a=he(s);return a==b||a==T||a==h||a==v}function ir(s){return typeof s=="number"&&s>-1&&s%1==0&&s<=c}function wr(s){var a=typeof s;return s!=null&&(a=="object"||a=="function")}function vt(s){return s!=null&&typeof s=="object"}var Mr=Nt?we(Nt):Dn;function ar(s){return sr(s)?wn(s):Rn(s)}function Hn(){return[]}function Un(){return!1}t.exports=$n}(lr,lr.exports);var Pi=lr.exports;const Y=Nr(Pi),xi="add",Qn="track",ts="trackItems",Li=`${Qn}:changed`,zi=`${ts}:changed`,es="state",Ni=`${es}:changed`,rs="bulk",Fr=`${rs}:edit`,dr="design",ns=`${dr}:load`,ss=`${dr}:resize`,U="add",is=`${U}:text`,as=`${U}:video`,os=`${U}:audio`,Fi=`${U}:placeholder`,cs=`${U}:image`,us=`${U}:illustration`,ls=`${U}:shape`,$i=`${U}:mask`,Hi=`${U}:transition`,ds=`${U}:animation`,fs=`${U}:caption`,ps=`${U}:template`,hs=`${U}:items`,ms=`${U}:composition`,gs=`${U}:progressBar`,Is=`${U}:progressFrame`,ys=`${U}:radialAudioBars`,bs=`${U}:linealAudioBars`,_s=`${U}:waveAudioBars`,ks=`${U}:hillAudioBars`,vs=`${U}:rect`,Et="edit",Ss=`${Et}:object`,Es=`${Et}:replaceMedia`,Ui=`${Et}:text`,ji=`${Et}:shape`,Bi=`${Et}:templateItem`,Yi=`${Et}:deleteTemplateItem`,Ts=`${Et}:backgroundEditor`,Wi="enterEditMode",Wt="active",Gi=`${Wt}:set`,Xi=`${Wt}:delete`,As=`${Wt}:paste`,Ki=`${Wt}:clone`,ws=`${Wt}:split`,X="layer",Vi=`${X}:locked`,Ji=`${X}:hidden`,qi=`${X}:move`,Ms=`${X}:select`,Zi=`${X}:selection`,Qi=`${X}:sendTo`,ta=`${X}:rename`,ea=`${X}:editingName`,Os=`${X}:copy`,ra=`${X}:paste`,Ds=`${X}:clone`,na=`${X}:split`,sa=`${X}:cut`,Rs=`${X}:delete`,Cs=`${X}:replace`,Fe="history",Ps=`${Fe}:undo`,xs=`${Fe}:redo`,ia=`${Fe}:reset`,$r="scale",Ls=`${$r}:changed`;var fr={exports:{}};fr.exports,function(t,r){var e=200,n="__lodash_hash_undefined__",i=9007199254740991,o="[object Arguments]",c="[object Array]",u="[object Boolean]",p="[object Date]",h="[object Error]",m="[object Function]",y="[object GeneratorFunction]",d="[object Map]",b="[object Number]",T="[object Object]",_="[object Promise]",E="[object RegExp]",f="[object Set]",I="[object String]",k="[object Symbol]",v="[object WeakMap]",w="[object ArrayBuffer]",M="[object DataView]",A="[object Float32Array]",j="[object Float64Array]",P="[object Int8Array]",Z="[object Int16Array]",D="[object Int32Array]",F="[object Uint8Array]",nt="[object Uint8ClampedArray]",Zt="[object Uint16Array]",Qt="[object Uint32Array]",be=/[\\^$.*+?()[\]{}|]/g,_e=/\w*$/,ke=/^\[object .+?Constructor\]$/,ve=/^(?:0|[1-9]\d*)$/,z={};z[o]=z[c]=z[w]=z[M]=z[u]=z[p]=z[A]=z[j]=z[P]=z[Z]=z[D]=z[d]=z[b]=z[T]=z[E]=z[f]=z[I]=z[k]=z[F]=z[nt]=z[Zt]=z[Qt]=!0,z[h]=z[m]=z[v]=!1;var Se=typeof pt=="object"&&pt&&pt.Object===Object&&pt,Ee=typeof self=="object"&&self&&self.Object===Object&&self,at=Se||Ee||Function("return this")(),te=r&&!r.nodeType&&r,N=te&&!0&&t&&!t.nodeType&&t,ee=N&&N.exports===te;function Te(s,a){return s.set(a[0],a[1]),s}function ot(s,a){return s.add(a),s}function re(s,a){for(var l=-1,g=s?s.length:0;++l<g&&a(s[l],l,s)!==!1;);return s}function ne(s,a){for(var l=-1,g=a.length,R=s.length;++l<g;)s[R+l]=a[l];return s}function Lt(s,a,l,g){for(var R=-1,O=s?s.length:0;++R<O;)l=a(l,s[R],R,s);return l}function zt(s,a){for(var l=-1,g=Array(s);++l<s;)g[l]=a(l);return g}function se(s,a){return s==null?void 0:s[a]}function Nt(s){var a=!1;if(s!=null&&typeof s.toString!="function")try{a=!!(s+"")}catch{}return a}function ie(s){var a=-1,l=Array(s.size);return s.forEach(function(g,R){l[++a]=[R,g]}),l}function Ft(s,a){return function(l){return s(a(l))}}function ae(s){var a=-1,l=Array(s.size);return s.forEach(function(g){l[++a]=g}),l}var Ae=Array.prototype,we=Function.prototype,Tt=Object.prototype,$t=at["__core-js_shared__"],oe=function(){var s=/[^.]+$/.exec($t&&$t.keys&&$t.keys.IE_PROTO||"");return s?"Symbol(src)_1."+s:""}(),ce=we.toString,ft=Tt.hasOwnProperty,At=Tt.toString,Me=RegExp("^"+ce.call(ft).replace(be,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),bt=ee?at.Buffer:void 0,wt=at.Symbol,Ht=at.Uint8Array,st=Ft(Object.getPrototypeOf,Object),ue=Object.create,le=Tt.propertyIsEnumerable,Oe=Ae.splice,Ut=Object.getOwnPropertySymbols,Mt=bt?bt.isBuffer:void 0,Ir=Ft(Object.keys,Object),De=It(at,"DataView"),de=It(at,"Map"),gt=It(at,"Promise"),Re=It(at,"Set"),Ve=It(at,"WeakMap"),fe=It(Object,"create"),Je=it(De),pe=it(de),qe=it(gt),Ze=it(Re),Qe=it(Ve),jt=wt?wt.prototype:void 0,yr=jt?jt.valueOf:void 0;function Ot(s){var a=-1,l=s?s.length:0;for(this.clear();++a<l;){var g=s[a];this.set(g[0],g[1])}}function sn(){this.__data__=fe?fe(null):{}}function an(s){return this.has(s)&&delete this.__data__[s]}function on(s){var a=this.__data__;if(fe){var l=a[s];return l===n?void 0:l}return ft.call(a,s)?a[s]:void 0}function br(s){var a=this.__data__;return fe?a[s]!==void 0:ft.call(a,s)}function tr(s,a){var l=this.__data__;return l[s]=fe&&a===void 0?n:a,this}Ot.prototype.clear=sn,Ot.prototype.delete=an,Ot.prototype.get=on,Ot.prototype.has=br,Ot.prototype.set=tr;function J(s){var a=-1,l=s?s.length:0;for(this.clear();++a<l;){var g=s[a];this.set(g[0],g[1])}}function cn(){this.__data__=[]}function un(s){var a=this.__data__,l=Pe(a,s);if(l<0)return!1;var g=a.length-1;return l==g?a.pop():Oe.call(a,l,1),!0}function ln(s){var a=this.__data__,l=Pe(a,s);return l<0?void 0:a[l][1]}function dn(s){return Pe(this.__data__,s)>-1}function fn(s,a){var l=this.__data__,g=Pe(l,s);return g<0?l.push([s,a]):l[g][1]=a,this}J.prototype.clear=cn,J.prototype.delete=un,J.prototype.get=ln,J.prototype.has=dn,J.prototype.set=fn;function Q(s){var a=-1,l=s?s.length:0;for(this.clear();++a<l;){var g=s[a];this.set(g[0],g[1])}}function pn(){this.__data__={hash:new Ot,map:new(de||J),string:new Ot}}function hn(s){return me(this,s).delete(s)}function mn(s){return me(this,s).get(s)}function gn(s){return me(this,s).has(s)}function In(s,a){return me(this,s).set(s,a),this}Q.prototype.clear=pn,Q.prototype.delete=hn,Q.prototype.get=mn,Q.prototype.has=gn,Q.prototype.set=In;function ct(s){this.__data__=new J(s)}function yn(){this.__data__=new J}function bn(s){return this.__data__.delete(s)}function _n(s){return this.__data__.get(s)}function kn(s){return this.__data__.has(s)}function vn(s,a){var l=this.__data__;if(l instanceof J){var g=l.__data__;if(!de||g.length<e-1)return g.push([s,a]),this;l=this.__data__=new Q(g)}return l.set(s,a),this}ct.prototype.clear=yn,ct.prototype.delete=bn,ct.prototype.get=_n,ct.prototype.has=kn,ct.prototype.set=vn;function Ce(s,a){var l=sr(s)||Le(s)?zt(s.length,String):[],g=l.length,R=!!g;for(var O in s)ft.call(s,O)&&!(R&&(O=="length"||zn(O,g)))&&l.push(O);return l}function _r(s,a,l){var g=s[a];(!(ft.call(s,a)&&Tr(g,l))||l===void 0&&!(a in s))&&(s[a]=l)}function Pe(s,a){for(var l=s.length;l--;)if(Tr(s[l][0],a))return l;return-1}function _t(s,a){return s&&nr(a,ar(a),s)}function er(s,a,l,g,R,O,L){var x;if(g&&(x=O?g(s,R,O,L):g(s)),x!==void 0)return x;if(!vt(s))return s;var B=sr(s);if(B){if(x=xn(s),!a)return Rn(s,x)}else{var $=Rt(s),tt=$==m||$==y;if(Ar(s))return xe(s,a);if($==T||$==o||tt&&!O){if(Nt(s))return O?s:{};if(x=kt(tt?{}:s),!a)return Cn(s,_t(x,s))}else{if(!z[$])return O?s:{};x=Ln(s,$,er,a)}}L||(L=new ct);var ut=L.get(s);if(ut)return ut;if(L.set(s,x),!B)var G=l?Pn(s):ar(s);return re(G||s,function(et,q){G&&(q=et,et=s[q]),_r(x,q,er(et,a,l,g,q,s,L))}),x}function Sn(s){return vt(s)?ue(s):{}}function En(s,a,l){var g=a(s);return sr(s)?g:ne(g,l(s))}function Tn(s){return At.call(s)}function An(s){if(!vt(s)||Fn(s))return!1;var a=ir(s)||Nt(s)?Me:ke;return a.test(it(s))}function wn(s){if(!Sr(s))return Ir(s);var a=[];for(var l in Object(s))ft.call(s,l)&&l!="constructor"&&a.push(l);return a}function xe(s,a){if(a)return s.slice();var l=new s.constructor(s.length);return s.copy(l),l}function rr(s){var a=new s.constructor(s.byteLength);return new Ht(a).set(new Ht(s)),a}function he(s,a){var l=a?rr(s.buffer):s.buffer;return new s.constructor(l,s.byteOffset,s.byteLength)}function kr(s,a,l){var g=a?l(ie(s),!0):ie(s);return Lt(g,Te,new s.constructor)}function vr(s){var a=new s.constructor(s.source,_e.exec(s));return a.lastIndex=s.lastIndex,a}function Mn(s,a,l){var g=a?l(ae(s),!0):ae(s);return Lt(g,ot,new s.constructor)}function On(s){return yr?Object(yr.call(s)):{}}function Dn(s,a){var l=a?rr(s.buffer):s.buffer;return new s.constructor(l,s.byteOffset,s.length)}function Rn(s,a){var l=-1,g=s.length;for(a||(a=Array(g));++l<g;)a[l]=s[l];return a}function nr(s,a,l,g){l||(l={});for(var R=-1,O=a.length;++R<O;){var L=a[R],x=void 0;_r(l,L,x===void 0?s[L]:x)}return l}function Cn(s,a){return nr(s,Dt(s),a)}function Pn(s){return En(s,ar,Dt)}function me(s,a){var l=s.__data__;return Nn(a)?l[typeof a=="string"?"string":"hash"]:l.map}function It(s,a){var l=se(s,a);return An(l)?l:void 0}var Dt=Ut?Ft(Ut,Object):Hn,Rt=Tn;(De&&Rt(new De(new ArrayBuffer(1)))!=M||de&&Rt(new de)!=d||gt&&Rt(gt.resolve())!=_||Re&&Rt(new Re)!=f||Ve&&Rt(new Ve)!=v)&&(Rt=function(s){var a=At.call(s),l=a==T?s.constructor:void 0,g=l?it(l):void 0;if(g)switch(g){case Je:return M;case pe:return d;case qe:return _;case Ze:return f;case Qe:return v}return a});function xn(s){var a=s.length,l=s.constructor(a);return a&&typeof s[0]=="string"&&ft.call(s,"index")&&(l.index=s.index,l.input=s.input),l}function kt(s){return typeof s.constructor=="function"&&!Sr(s)?Sn(st(s)):{}}function Ln(s,a,l,g){var R=s.constructor;switch(a){case w:return rr(s);case u:case p:return new R(+s);case M:return he(s,g);case A:case j:case P:case Z:case D:case F:case nt:case Zt:case Qt:return Dn(s,g);case d:return kr(s,g,l);case b:case I:return new R(s);case E:return vr(s);case f:return Mn(s,g,l);case k:return On(s)}}function zn(s,a){return a=a??i,!!a&&(typeof s=="number"||ve.test(s))&&s>-1&&s%1==0&&s<a}function Nn(s){var a=typeof s;return a=="string"||a=="number"||a=="symbol"||a=="boolean"?s!=="__proto__":s===null}function Fn(s){return!!oe&&oe in s}function Sr(s){var a=s&&s.constructor,l=typeof a=="function"&&a.prototype||Tt;return s===l}function it(s){if(s!=null){try{return ce.call(s)}catch{}try{return s+""}catch{}}return""}function Er(s){return er(s,!0,!0)}function Tr(s,a){return s===a||s!==s&&a!==a}function Le(s){return $n(s)&&ft.call(s,"callee")&&(!le.call(s,"callee")||At.call(s)==o)}var sr=Array.isArray;function ze(s){return s!=null&&wr(s.length)&&!ir(s)}function $n(s){return Mr(s)&&ze(s)}var Ar=Mt||Un;function ir(s){var a=vt(s)?At.call(s):"";return a==m||a==y}function wr(s){return typeof s=="number"&&s>-1&&s%1==0&&s<=i}function vt(s){var a=typeof s;return!!s&&(a=="object"||a=="function")}function Mr(s){return!!s&&typeof s=="object"}function ar(s){return ze(s)?Ce(s):wn(s)}function Hn(){return[]}function Un(){return!1}t.exports=Er}(fr,fr.exports);var aa=fr.exports;const C=Nr(aa);function oa(t,r){return t.filter(n=>{if(r.forEach(i=>{n.items.includes(i)&&(n.items=n.items.filter(o=>o!==i))}),n.items.length!==0||n.static)return n})}const K=t=>Object.keys(t).reduce((r,e)=>{const{display:n}=t[e];return Math.max(r,n.to)},0);function rt(t,r,e){t.forEach(n=>{const i=Object.values(r).filter(d=>n.items.includes(d.id)),c=i.filter(d=>!e.includes(d.id)).sort((d,b)=>d.display.from-b.display.from),u=c[c.length-1];let p=(u==null?void 0:u.display.to)||0;i.forEach(d=>{if(e.includes(d.id)){const b=d.display.to-d.display.from;d.display={from:p,to:p+b},p=p+b}});const m=i.sort((d,b)=>d.display.from-b.display.from).map(d=>d.id);let y=0;m.forEach(d=>{const b=[];let T=0;if(b.forEach(_=>{_.forEach(E=>{E.type==="transition"&&(T+=E.duration)})}),r[d]){const _=r[d].display.to-r[d].display.from;r[d].display={from:y-T,to:y+_-T},y+=_}})})}function ca(t,r,e){const n=t.toId,i=e[n],o=r.find(c=>c.items.includes(n));o&&(o.magnetic||o.items.forEach(c=>{const u=e[c];u.display.from>i.display.from&&(u.display.from=u.display.from+t.duration,u.display.to=u.display.to+t.duration)}))}function ua(t,r){const e=C(t),n=r&&r.length?r:e.activeIds,i=n.map(I=>e.trackItemsMap[I]).filter(I=>!!I).map(I=>I.id),o=e.transitionIds.filter(I=>{const k=e.transitionsMap[I];return i.includes(k.fromId)||i.includes(k.toId)});i.push(...o);const c={},u=e.trackItemIds,p=e.transitionIds,h=C(e.tracks),m=C(e.structure);i.forEach(I=>{var v;const k=e.trackItemsMap[I]||e.transitionsMap[I];if(k.type==="template"||k.type==="composition"){const w=(v=e.structure.find(A=>A.id===k.id))==null?void 0:v.items;i.push(...w);const M=m.findIndex(A=>A.id===k.id);m.splice(M,1)}}),i.forEach(I=>{m.forEach(k=>{k.items.includes(I)&&(k.items=k.items.filter(v=>v!==I))})});const y=u.filter(I=>!i.includes(I));p.forEach(I=>{n.includes(I)&&n.length===1&&(c[I]=C(e.transitionsMap[I]))});const d=p.filter(I=>!i.includes(I)&&!n.includes(I)),b=Object.fromEntries(Object.entries(e.transitionsMap).filter(([I])=>!i.includes(I)));Object.keys(b).forEach(I=>{n.includes(I)&&(b[I].kind="none")});const T=oa(e.tracks,i),_=Object.fromEntries(Object.entries(e.trackItemsMap).filter(([I])=>!i.includes(I))),E=h.filter(I=>I.magnetic);rt(E,_,[]);const f=K(_);return Object.keys(c).forEach(I=>{ca(c[I],T,_)}),{trackItemIds:y,activeIds:[],trackItemsMap:_,tracks:T,duration:f,structure:m,transitionIds:d,transitionsMap:b}}const la="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let zs=(t=21)=>{let r="",e=crypto.getRandomValues(new Uint8Array(t|=0));for(;t--;)r+=la[e[t]&63];return r};function Gt(t=16){const r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",e=r.charAt(Math.floor(Math.random()*r.length));let n=zs(t-1);return n=n.replace(/[^a-zA-Z0-9]/g,"").slice(0,t-1),e+n}const $e=t=>{const r=t.map(e=>new FontFace(e.fontFamily,`url(${e.url})`).load().catch(n=>n));return r.length===0?Promise.resolve(!0):new Promise((e,n)=>{Promise.all(r).then(i=>{i.forEach(o=>{o&&o.family&&(document.fonts.add(o),e(!0))})}).catch(i=>n(i))})};async function da(t){const r=localStorage.getItem("DesignComboTemp");if(!r)return{};const e={...t},n=JSON.parse(r),i={},o=n.trackItemsMap,c=n.tracks,u=[],p=n.activeIds.map(async h=>{const m=o[h];(m.type==="caption"||m.type==="text")&&m.details.fontUrl&&await $e([{fontFamily:m.details.fontFamily,url:m.details.fontUrl}]);const y=Gt();return i[h]=y,e.trackItemsMap[y]={...o[h],id:y,details:m.details},e.trackItemIds.push(y),!0});return await Promise.all(p),c.forEach(h=>{const m=h.items.map(d=>i[d]),y={...h,magnetic:!1,static:!1,items:m,id:Gt()};u.push(y)}),e.tracks=[...u,...e.tracks],{tracks:e.tracks,trackItemIds:e.trackItemIds,trackItemsMap:e.trackItemsMap}}let pr={cors:{audio:!0,video:!0,image:!0},acceptsMap:{text:["text","caption","composition"],image:["image","video"],video:["video","image"],audio:["audio"],composition:["composition"],caption:["caption","text","composition"],template:["template","image","video"],customTrack:["video","image","template"],customTrack2:["video","image","template"],illustration:["illustration","custom"],custom:["custom","video","illustration"],main:["video","image","template"],shape:["shape","custom","illustration"],linealAudioBars:["audio","linealAudioBars"],radialAudioBars:["audio","radialAudioBars"],progressFrame:["audio","progressFrame"],progressBar:["audio","progressBar"],rect:["rect"]}};const fa=t=>{const r=Object.fromEntries(Object.entries(t).filter(([e,n])=>n!==void 0));pr={...pr,...r}},Hr=()=>pr.cors,Ns=()=>pr.acceptsMap,Ie=t=>new Promise((r,e)=>{const n=new Image;n.onload=()=>{const o=n.width,c=n.height;r({width:o,height:c})},n.onerror=o=>{e(o)},Hr().image&&(n.crossOrigin="anonymous"),n.src=t}),Fs=t=>new Promise((r,e)=>{const n=new Audio;n.preload="auto",n.addEventListener("loadedmetadata",()=>{const o=n.duration*1e3;r({duration:o})}),n.addEventListener("error",o=>{e(o)}),n.src=t,Hr().audio&&(n.crossOrigin="anonymous"),n.load()}),Ur=t=>new Promise((r,e)=>{const n=document.createElement("video");n.preload="auto",n.addEventListener("loadedmetadata",()=>{const o=n.duration*1e3,c=n.videoWidth,u=n.videoHeight;r({duration:o,width:c,height:u})}),n.addEventListener("error",o=>{e(o)}),n.src=t,Hr().video&&(n.crossOrigin="anonymous"),n.load()}),pa=async t=>{var i,o;const r=t.duration,e=(i=t.details)==null?void 0:i.width,n=(o=t.details)==null?void 0:o.height;return r&&e&&n?{duration:r,width:e,height:n}:Ur(t.details.src)},$s=(t,r)=>{const e=document.createElement("div");Object.keys(r).forEach(i=>{i!=="height"&&(e.style[i]=r[i])}),document.body.appendChild(e),e.textContent=t,e.style.whiteSpace="normal",e.style.position="absolute",e.style.visibility="hidden",e.style.display="inline-block",e.style.width=r.width+"px",e.style.fontSize=r.fontSize+"px";const n=getComputedStyle(e).height;return document.body.removeChild(e),parseFloat(n)},Hs=(t,r)=>{var u,p;const e=((u=t.details.crop)==null?void 0:u.width)||t.details.width||0,n=((p=t.details.crop)==null?void 0:p.height)||t.details.height||0;let i=r.width,o=r.height;const c=r.width/r.height;return e/n>c?(i=e,o=e/c):(o=n,i=n*c),{newWidth:i,newHeight:o,crop:{x:0,y:0,height:n,width:e}}},Us=(t,r)=>{const e=C(t.trim),n=C(t.display);return r.duration<t.display.to&&(n.to=r.duration,e&&(e.to=r.duration)),{duration:r.duration,trim:e,display:n}};async function ha(t,r){const e={...t},n=Object.keys(r)[0],i=Object.values(r)[0],o=e.trackItemsMap[n],c={...e.trackItemsMap[n]},u=o.details;if(!i.details.src)return{};if(o.type==="image"){const p=await Ie(i.details.src),{crop:h,newHeight:m,newWidth:y}=Hs(o,p);i.details.crop=h,i.details.height=m,i.details.width=y}else if(o.type==="video"){const p=await Ur(i.details.src),h=e.trackItemsMap[n],{display:m,duration:y,trim:d}=Us(h,p),{crop:b,newHeight:T,newWidth:_}=Hs(o,p);i.details.crop=b,i.details.height=T,i.details.width=_,c.display=m,c.duration=y,c.trim=d}else if(o.type==="audio"){const p=await Fs(i.details.src),h=e.trackItemsMap[n],{display:m,duration:y,trim:d}=Us(h,p);c.display=m,c.duration=y,c.trim=d}return o.details={...u,...i.details},e.trackItemsMap[n]={...c},{trackItemsMap:{...e.trackItemsMap,[n]:{...c,details:{...u,...i.details}}}}}function ma(t,r){const e=C(t),n={},i=r&&r.length?r:e.activeIds;if(i.length===0)return{};i.forEach(c=>{const u=e.trackItemsMap[c],p=Gt();e.trackItemsMap[p]={...C(u),id:p},e.trackItemIds.push(p);const h=e.tracks.find(m=>m.items.includes(c));n[h.id]?n[h.id].items.push(p):n[h.id]={...h,id:Gt(),items:[p],static:!1,magnetic:!1}});const o=Object.values(n);return e.tracks=[...o,...e.tracks],{trackItemsMap:e.trackItemsMap,tracks:e.tracks,trackItemIds:e.trackItemIds}}function ga(t){const r=/#([0-9a-fA-F]{3,6})\b/g,e=/rgb\(\s*(\d+),\s*(\d+),\s*(\d+)\s*\)/g,n=/rgba\(\s*(\d+),\s*(\d+),\s*(\d+),\s*([0-9.]+)\s*\)/g;function i(c){return c.length===3?`#${c[0]}${c[0]}${c[1]}${c[1]}${c[2]}${c[2]}`.toUpperCase():`#${c.toUpperCase()}`}function o(c,u,p){return`#${(1<<24|c<<16|u<<8|p).toString(16).slice(1).toUpperCase()}`}return t=t.replace(r,(c,u)=>i(u)),t=t.replace(e,(c,u,p,h)=>o(+u,+p,+h)),t=t.replace(n,(c,u,p,h)=>o(+u,+p,+h)),t}function V(t){return/^#[0-9a-fA-F]{3}$/.test(t)?"#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]:t}function js(t,r){let e=t;for(const n in r)if(Object.prototype.hasOwnProperty.call(r,n)){const i=new RegExp(n,"g");e=e.replace(i,r[n])}return e}function Bs(t){const r=t.getAttribute("fill");if(r&&r.trim()!==""&&r.trim()!=="none")return r.trim();const e=t.getAttribute("style");if(e){const i=/fill\s*:\s*([^;]+);?/.exec(e);if(i){const o=i[1].trim();if(o!==""&&o!=="none")return o}}const n=t.parentElement;return n?Bs(n):null}function He(t){return/^#([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6})$/.test(t)}const Ia=t=>{const r=`.${t.split(".").filter(o=>o.includes("fill:")).join(".")}`,e={},n=/\.([\w-]+)\s*\{\s*([^}]+)\s*\}/g;let i;for(;(i=n.exec(r))!==null;){const o=i[1],c=i[2],u={},p=/fill\s*:\s*([^;]+);?/.exec(c),h=/stroke\s*:\s*([^;]+);?/.exec(c);p&&(u.fill=V(p[1].trim())),h&&(u.stroke=V(h[1].trim())),e[o]=u}return e};function jr(t){let r=t.parentElement;for(;r;){if(r.tagName.toLowerCase()==="mask")return!0;r=r.parentElement}return!1}function ya(t,r,e=300,n=300){const i=[],c=new DOMParser().parseFromString(t,"image/svg+xml"),u=c.documentElement;u.setAttribute("width",`${e}`),u.setAttribute("height",`${n}`);const p=u.querySelectorAll("style"),h={};p.forEach(_=>{const E=_.textContent||"",f=Ia(E);Object.assign(h,f);const I=E.replace(/\.(st[\w-]+)/g,`.${r}-$1`).replace(/url\(#(.*?)\)/g,`url(#${r}-$1)`);_.textContent=I;const k=Array.from(c.querySelectorAll("*")),v=new Set;k.forEach(w=>{if(jr(w))return;["fill","stroke","stop-color"].forEach(j=>{const P=w.getAttribute(j);P&&!["none","transparent"].includes(P)&&v.add(V(P))});const M=w.getAttribute("style");if(M){const j=/fill\s*:\s*([^;]+);?/.exec(M),P=/stroke\s*:\s*([^;]+);?/.exec(M),Z=/stop-color\s*:\s*([^;]+);?/.exec(M);if(j){const D=j[1].trim();D&&!["none","transparent"].includes(D)&&He(V(D))&&v.add(V(D))}if(P){const D=P[1].trim();D&&!["none","transparent"].includes(D)&&He(V(D))&&v.add(V(D))}if(Z){const D=Z[1].trim();D&&!["none","transparent"].includes(D)&&He(V(D))&&v.add(V(D))}}const A=w.getAttribute("class");A&&A.split(" ").forEach(j=>{const P=h[j];P!=null&&P.fill&&!["none","transparent"].includes(P.fill)&&v.add(V(P.fill)),P!=null&&P.stroke&&!["none","transparent"].includes(P.stroke)&&v.add(V(P.stroke))})}),Array.from(v).forEach(w=>{He(w)&&i.push(w)})});const m=Array.from(c.querySelectorAll("*")),y=new Set;return m.forEach(_=>{if(jr(_))return;const E=_.getAttribute("class");if(E){const I=E.split(" ").map(k=>`${r}-${k}`).join(" ");_.setAttribute("class",I),I.split(" ").forEach(k=>{const v=h[k];v!=null&&v.fill&&!["none","transparent"].includes(v.fill)&&y.add(V(v.fill)),v!=null&&v.stroke&&!["none","transparent"].includes(v.stroke)&&y.add(V(v.stroke))})}["fill","stroke","stop-color"].forEach(I=>{const k=_.getAttribute(I);k&&!["none","transparent"].includes(k)&&y.add(V(k))});const f=_.getAttribute("style");if(f){const I=/fill\s*:\s*([^;]+);?/.exec(f),k=/stroke\s*:\s*([^;]+);?/.exec(f),v=/stop-color\s*:\s*([^;]+);?/.exec(f);if(I){const w=I[1].trim();w&&!["none","transparent"].includes(w)&&y.add(V(w))}if(k){const w=k[1].trim();w&&!["none","transparent"].includes(w)&&y.add(V(w))}if(v){const w=v[1].trim();w&&!["none","transparent"].includes(w)&&y.add(V(w))}}}),y.forEach(_=>!i.includes(_)&&He(_)&&i.push(_)),Array.from(c.querySelectorAll("*")).forEach(_=>{if(_.hasAttribute("id")){const E=_.getAttribute("id");_.setAttribute("id",`${r}-${E}`)}if(["fill","stroke","stop-color","filter","clip-path","mask"].forEach(E=>{const f=_.getAttribute(E);f&&f.includes("url(#")&&_.setAttribute(E,f.replace(/url\(#(.*?)\)/g,`url(#${r}-$1)`))}),_.hasAttribute("style")){const E=_.getAttribute("style");E.includes("url(#")&&_.setAttribute("style",E.replace(/url\(#(.*?)\)/g,`url(#${r}-$1)`))}}),Array.from(c.querySelectorAll("path")).forEach(_=>{if(jr(_))return;!Bs(_)&&!_.getAttribute("class")&&(_.setAttribute("fill","#000000"),i.includes("#000000")||i.push("#000000"))}),{serializer:new XMLSerializer().serializeToString(c),colors:i}}const Ue={color:"#000000",x:0,y:0,blur:0},ht=(t,r)=>{let e=r!=null&&r.trim?r.trim.to-r.trim.from:(r==null?void 0:r.duration)||5e3;const n={from:0,to:e};if(!t)return n;if(t.from<0)return console.error("'from' must be a non-negative number. Returning default display."),n;if(t.from!==void 0&&t.to===void 0)return{from:t.from,to:t.from+e};if(t.to!==void 0){if(t.to<0)return console.error("'to' must be a non-negative number. Returning default display."),n;if(t.to<t.from)return console.error("'to' must be greater than or equal to 'from'. Returning default display."),n}return t},Ys=(t,r)=>t?t.from&&!t.to?{from:t.from,to:r.duration}:t:{from:0,to:r.duration};function Ws(t,r){const e={x:t.size.width/2,y:t.size.height/2},n={x:r.width/2,y:r.height/2},i=e.x-n.x;return{top:`${e.y-n.y}px`,left:`${i}px`,transform:"none"}}function mt(t,r){const e=t.scaleMode,n={x:t.size.width/2,y:t.size.height/2},i={x:r.width/2,y:r.height/2};let o;if(e==="fill")o=Math.max(t.size.width/r.width,t.size.height/r.height);else if(e==="fit"){const p=t.scaleAspectRatio||1;o=Math.min(t.size.width/r.width,t.size.height/r.height)*p}else o=Math.min(t.size.width/r.width,t.size.height/r.height);const c=n.x-i.x;return{top:`${n.y-i.y}px`,left:`${c}px`,transform:`scale(${o})`}}const Gs=async(t,r)=>{const e=t.details.src,n=await pa(t),i=mt(r,{...n}),o=Ys(t.trim,{duration:n.duration}),c={width:n.width,height:n.height,opacity:100,src:e,volume:t.details.volume??100,borderRadius:t.details.borderRadius??0,borderWidth:t.details.borderWidth??0,borderColor:t.details.borderColor||"#000000",boxShadow:t.details.boxShadow||Ue,top:t.details.top||i.top||"0px",left:t.details.left||i.left||"0px",transform:t.details.transform||i.transform,blur:t.details.blur||0,brightness:t.details.brightness||100,flipX:t.details.flipX||!1,flipY:t.details.flipY||!1,rotate:t.details.rotate||"0deg",visibility:t.details.visibility||"visible"};return{...t,trim:o,type:"video",name:"video",details:c,playbackRate:t.playbackRate||1,display:ht(t.display,{duration:n.duration,trim:o}),duration:n.duration}},Xs=async t=>{const r=t.id,e=t.details,i=(await Fs(e.src)).duration,o=Ys(t.trim,{duration:i});return{id:r,name:t.name||"audio",type:"audio",display:ht(t.display,{duration:i,trim:o}),trim:o,playbackRate:t.playbackRate||1,details:{src:e.src,volume:e.volume??100},metadata:{...t.metadata},duration:i}},ba=async(t,r)=>{var u,p;const e=t.id,n={width:((u=t.details)==null?void 0:u.width)||r.size.width,height:((p=t.details)==null?void 0:p.height)||r.size.height},i=t.details,o=mt(r,n),c=ht(t.display);return{id:e,name:t.type,type:t.type,display:c,details:{width:(i==null?void 0:i.width)||n.width,height:(i==null?void 0:i.height)||n.height,top:(i==null?void 0:i.top)||o.top,left:(i==null?void 0:i.left)||o.left,border:i.border||"none",borderRadius:i.borderRadius||0,borderWidth:i.borderWidth||0,borderColor:i.borderColor||"#000000",opacity:i.opacity||100,flipX:i.flipX||!1,flipY:i.flipY||!1,inverted:i.inverted||!1,backgroundColors:(i==null?void 0:i.backgroundColors)||["rgba(128, 128, 128,0.5)","rgba(128, 128, 128,1)"]},metadata:{}}},_a=async(t,r)=>{var u,p;const e=t.id,n={width:((u=t.details)==null?void 0:u.width)||r.size.width,height:((p=t.details)==null?void 0:p.height)||r.size.height},i=t.details,o=mt(r,n),c=ht(t.display);return{id:e,name:t.type,type:t.type,display:c,details:{width:(i==null?void 0:i.width)||n.width,height:(i==null?void 0:i.height)||n.height,top:(i==null?void 0:i.top)||o.top,left:(i==null?void 0:i.left)||o.left,border:i.border||"none",borderRadius:i.borderRadius||0,borderWidth:i.borderWidth||0,borderColor:i.borderColor||"#000000",opacity:i.opacity||100,flipX:i.flipX||!1,flipY:i.flipY||!1,inverted:i.inverted||!1,backgroundColors:(i==null?void 0:i.backgroundColors)||["rgba(128, 128, 128,0.5)","rgba(128, 128, 128,1)"],barThickness:i.barThickness||10},metadata:{}}},ka=async(t,r)=>{var u,p;const e=t.id,n={width:((u=t.details)==null?void 0:u.width)||r.size.width,height:((p=t.details)==null?void 0:p.height)||r.size.height},i=t.details,o=mt(r,n),c=ht(t.display);return{id:e,name:t.type,type:t.type,display:c,details:{width:(i==null?void 0:i.width)||n.width,height:(i==null?void 0:i.height)||n.height,top:(i==null?void 0:i.top)||o.top,left:(i==null?void 0:i.left)||o.left,radialBarColor:i.radialBarColor||"rgba(128, 128, 128,1)",border:i.border||"none",borderRadius:i.borderRadius||0,borderWidth:i.borderWidth||0,borderColor:i.borderColor||"#000000",opacity:i.opacity||100,flipX:i.flipX||!1,flipY:i.flipY||!1},metadata:{}}},Br=async(t,r)=>{var c,u;const e=t.id,n={width:((c=t.details)==null?void 0:c.width)||r.size.width,height:((u=t.details)==null?void 0:u.height)||r.size.height},i=t.details,o=mt(r,n);return{id:e,name:t.type,type:t.type,display:{from:0,to:t.duration||1e4},details:{width:(i==null?void 0:i.width)||n.width,height:(i==null?void 0:i.height)||n.height,top:(i==null?void 0:i.top)||o.top,left:(i==null?void 0:i.left)||o.left,border:i.border||"none",borderRadius:i.borderRadius||0,borderWidth:i.borderWidth||0,borderColor:i.borderColor||"#000000",opacity:i.opacity||100,flipX:i.flipX||!1,flipY:i.flipY||!1,inverted:i.inverted||!1,linealBarColor:i.linealBarColor||"rgba(128, 128, 128,1)",lineThickness:i.lineThickness||1,gapSize:i.gapSize||1,roundness:i.roundness||1,placement:i.placement||null,strokeColor:i.strokeColor||"#92E1B0",fillColor:i.fillColor||null,strokeWidth:i.strokeWidth||null,copies:i.copies||null,offsetPixelSpeed:i.offsetPixelSpeed||0,lineColor:i.lineColor||"#92E1B0",lineGap:i.lineGap||0,topRoundness:i.topRoundness||0,bottomRoundness:i.bottomRoundness||0,lines:i.lines||0,sections:i.sections||0},metadata:{}}},Ks=async(t,r)=>{var y;const e=t.trackItemIds,n=t.size||{width:t.details.width,height:t.details.height},i=Math.min(r.size.width/n.width,r.size.height/n.height),o=((y=t.details)==null?void 0:y.rotate)||0,c=mt(r,n),u=t.display;let p=1/0,h=0;e.forEach(d=>{const b=t.trackItemsMap[d];b.display.from<p&&(p=b.display.from),b.display.to>h&&(h=b.display.to)});const m=t.trim||t.display||{from:p,to:h};return{id:t.id,type:"template",details:{...n,transform:t.details.transform||c.transform,top:t.details.top||c.top,left:t.details.left||c.left,scale:i,rotate:o,background:t.details.background||"transparent"},trim:m,display:u||{from:p,to:h},activeEdit:!1}},va=async(t,r)=>{var m;const e=t.trackItemIds,n=t.size||{width:t.details.width,height:t.details.height},i=Math.min(r.size.width/n.width,r.size.height/n.height),o=((m=t.details)==null?void 0:m.rotate)||0,c=mt(r,n),u=t.display;let p=1/0,h=0;return e.forEach(y=>{const d=t.trackItemsMap[y];d.display.from<p&&(p=d.display.from),d.display.to>h&&(h=d.display.to)}),{id:t.id,type:"composition",details:{...n,transform:t.details.transform||c.transform,top:t.details.top||c.top,left:t.details.left||c.left,scale:i,rotate:o},display:u||{from:p,to:h}}},Vs=async(t,r)=>{const e=t.details,n=Ie(e.src),i=fetch(e.src),[o,c]=await Promise.all([n,i]),u=await c.text(),p=mt(r,o),{serializer:h,colors:m}=ya(ga(u),t.id,Number(e.width||o.width),Number(e.height||o.height)),y=t.details.colorMap||Object.fromEntries(m.map(d=>[d,d]));return{id:t.id,name:"illustration",type:t.type,display:ht(t.display),playbackRate:t.playbackRate||1,details:{src:e.src||"",width:e.width||o.width||100,height:e.height||o.height||100,opacity:e.opacity??100,transform:e.transform||p.transform,border:e.border||"none",borderRadius:e.borderRadius||0,top:e.top||p.top||"0px",left:e.left||p.left||"0px",borderWidth:e.borderWidth??0,borderColor:e.borderColor||"#000000",flipX:e.flipX||!1,flipY:e.flipY||!1,rotate:e.rotate||"0deg",visibility:e.visibility||"visible",svgString:h,initialSvgString:C(h),colorMap:y},metadata:t.metadata||{}}},Sa=async(t,r)=>{const e=t.details,n=Ie(e.src),[i]=await Promise.all([n]),o=mt(r,i);return{id:t.id,name:"shape",type:t.type,display:ht(t.display),playbackRate:t.playbackRate||1,details:{src:e.src||"",width:e.width||i.width||100,height:e.height||i.height||100,opacity:e.opacity??100,transform:e.transform||o.transform,border:e.border||"none",borderRadius:e.borderRadius||0,top:e.top||o.top||"0px",left:e.left||o.left||"0px",borderWidth:e.borderWidth??0,borderColor:e.borderColor||"#000000",flipX:e.flipX||!1,flipY:e.flipY||!1,rotate:e.rotate||"0deg",visibility:e.visibility||"visible",backgroundColor:e.backgroundColor||"#808080"},metadata:t.metadata||{}}},Ea=async(t,r)=>{const e=t.details,n=mt(r,{width:e.width,height:e.height});return{id:t.id,name:"rect",type:t.type,display:ht(t.display),playbackRate:t.playbackRate||1,details:{width:e.width||100,height:e.height||100,opacity:e.opacity??100,transform:e.transform||n.transform,border:e.border||"none",borderRadius:e.borderRadius||0,top:e.top||n.top||"0px",left:e.left||n.left||"0px",borderWidth:e.borderWidth??0,borderColor:e.borderColor||"#000000",flipX:e.flipX||!1,flipY:e.flipY||!1,rotate:e.rotate||"0deg",visibility:e.visibility||"visible",backgroundColor:e.backgroundColor||"#808080",boxShadow:e.boxShadow||Ue,blur:e.blur||0,brightness:e.brightness||100},metadata:t.metadata||{}}},Js=async(t,r)=>{const e=t.details,n=await Ie(e.src),i=mt(r,n);return{id:t.id,type:"image",name:"image",display:ht(t.display),playbackRate:t.playbackRate||1,details:{src:e.src||"",width:e.width||n.width||100,height:e.height||n.height||100,opacity:e.opacity??100,transform:e.transform||i.transform,border:e.border||"none",borderRadius:e.borderRadius||0,boxShadow:e.boxShadow||Ue,top:e.top||i.top||"0px",left:e.left||i.left||"0px",borderWidth:e.borderWidth??0,borderColor:e.borderColor||"#000000",blur:e.blur||0,brightness:e.brightness||100,flipX:e.flipX||!1,flipY:e.flipY||!1,rotate:e.rotate||"0deg",visibility:e.visibility||"visible"},metadata:t.metadata||{}}},qs=async(t,r)=>{const e=t;e.details.fontUrl&&await $e([{fontFamily:e.details.fontFamily,url:e.details.fontUrl}]);const n=e.id,i=e.details,o=Qs(i),c=i.height||$s(e.details.text,o),u=i.top!=null&&i.left!=null?{top:`${i.top}px`,left:`${i.left}px`}:Ws(r,{width:o.width,height:c});return{id:n,name:"caption",type:"caption",display:ht(e.display),details:{...e.details,...o,text:i.text||"",height:c,fontUrl:i.fontUrl,top:o.top||u.top,left:o.left||u.left,borderWidth:i.borderWidth||0,borderColor:i.borderColor||"#000000",boxShadow:i.boxShadow||Ue,words:i.words||[],appearedColor:i.appearedColor||i.color,activeColor:i.activeColor||i.color,activeFillColor:i.activeFillColor||"transparent"},metadata:t.metadata||{}}},Zs=async(t,r)=>{t.details.fontUrl&&await $e([{fontFamily:t.details.fontFamily,url:t.details.fontUrl}]);const e=t.id,n=t.details,i=Qs(n),o=n.height||$s(t.details.text,i),c=n.top!=null&&n.left!=null?{top:`${n.top}px`,left:`${n.left}px`}:Ws(r,{width:i.width,height:o});return{id:e,name:"text",type:"text",display:ht(t.display),details:{...t.details,...i,text:n.text||"",height:o,fontUrl:n.fontUrl,top:i.top||c.top,left:i.left||c.left,borderWidth:n.borderWidth||0,borderColor:n.borderColor||"#000000",boxShadow:n.boxShadow||Ue},metadata:{}}},Qs=t=>({fontFamily:t.fontFamily||"Arial",fontSize:t.fontSize||"16px",fontWeight:t.fontWeight||"normal",fontStyle:t.fontStyle||"normal",textDecoration:t.textDecoration||"none",textAlign:t.textAlign||"left",lineHeight:t.lineHeight||"normal",letterSpacing:t.letterSpacing||"normal",wordSpacing:t.wordSpacing||"normal",color:t.color||"#ffffff",backgroundColor:t.backgroundColor||"transparent",border:t.border||"none",textShadow:t.textShadow||"none",text:t.text||"",opacity:t.opacity??100,width:t.width||300,wordWrap:t.wordWrap||"normal",wordBreak:t.wordBreak||"normal",WebkitTextStrokeColor:t.WebkitTextStrokeColor||"#ffffff",WebkitTextStrokeWidth:t.WebkitTextStrokeWidth||"0px",top:t.top,left:t.left,textTransform:t.textTransform||"none",transform:t.transform||"none",skewX:t.skewX||0,skewY:t.skewY||0}),Ta=async(t,r)=>{switch(t.type){case"video":return Gs(t,r||{});case"audio":return Xs(t);case"image":return Js(t,r||{});case"text":return Zs(t,r||{});case"caption":return qs(t,r||{});case"template":return Ks(t,{size:r==null?void 0:r.size});default:throw new Error("Unsupported track item")}};function ti(t,r){return r.some(e=>t.some(n=>n.id===e.id))}const ei=(t=[],r=[])=>t.length===0?r.map(n=>({id:Gt(),items:[n.id],type:n.type,accepts:["text","image","video","audio","caption","template"]})):t.map(e=>({...e,items:e.items||[],accepts:["audio","video","image","text","caption","template"],type:e.type||"text",magnetic:e.magnetic||!1,static:e.static||!1,id:e.id||Gt()}));async function Aa(t,r){var c,u,p;const e=r.trackItemsMap,n=new Set,i=new Map;for(const h in e){const m=e[h];if(m.type==="text"||m.type==="caption"){if(m.details.fontUrl){const y={fontFamily:m.details.fontFamily,url:m.details.fontUrl};n.add(JSON.stringify(y))}(c=m.animations)!=null&&c.in&&m.animations.in.composition.forEach(y=>{var d;(d=y.details)!=null&&d.fonts&&y.details.fonts.forEach(b=>{n.add(JSON.stringify(b))})}),(u=m.animations)!=null&&u.loop&&m.animations.loop.composition.forEach(y=>{var d;(d=y.details)!=null&&d.fonts&&y.details.fonts.forEach(b=>{n.add(JSON.stringify(b))})}),(p=m.animations)!=null&&p.out&&m.animations.out.composition.forEach(y=>{var d;(d=y.details)!=null&&d.fonts&&y.details.fonts.forEach(b=>{n.add(JSON.stringify(b))})})}else m.type==="illustration"&&i.set(h,{trackItem:m,details:m.details})}n.size>0&&await $e(Array.from(n).map(h=>JSON.parse(h)));for(const[h,m]of i){const y=await Vs({...m.trackItem,details:m.details},{size:{width:m.details.width,height:m.details.height}}),d=js(y.details.svgString,m.details.colorMap);y.details.svgString=d,e[h]=y}const o=K(e);return{...r,duration:o}}function wa(t){const r=C(t);if(!r.activeIds.length)return;const e=r.activeIds,n=[],i={activeIds:e,trackItemsMap:{},tracks:[]};e.forEach(c=>{i.trackItemsMap[c]=r.trackItemsMap[c],n.push(r.tracks.find(u=>u.items.includes(c)))});const o=new Set;n.filter(c=>o.has(c.id)?!1:(o.add(c.id),!0)),i.tracks=Array.from(o),localStorage.setItem("DesignComboTemp",JSON.stringify(i))}function Ma(t,r){const e=C(t);if(e.activeIds.length!==1)return{};const n=e.activeIds[0],i=C(e.trackItemsMap[n]);if(r>=i.display.to||r<=i.display.from)return{};const o=Gt(),c={...i,display:{from:i.display.from,to:r}},u={...i,id:o,display:{from:r,to:i.display.to}},p=Object.values(e.transitionsMap).find(m=>m.fromId===i.id&&m.kind!=="none"),h=Object.values(e.transitionsMap).find(m=>m.toId===i.id&&m.kind!=="none");if(i.type==="video"||i.type==="audio"){const m=r-c.display.from;c.trim={from:i.trim.from,to:i.trim.from+m},u.trim={from:i.trim.from+m,to:i.trim.to}}if(h){const m=c.display.to-c.display.from;if(h.duration/2>m){e.transitionIds=e.transitionIds.filter(d=>d!==h.id);const y={};e.transitionIds.forEach(d=>y[d]=e.transitionsMap[d]),e.transitionsMap=y}}if(p){const m=u.display.to-u.display.from,y={};p.duration/2>m?(e.transitionIds=e.transitionIds.filter(d=>d!==p.id),e.transitionIds.forEach(d=>y[d]=e.transitionsMap[d]),e.transitionsMap=y):(e.transitionIds=e.transitionIds.map(d=>e.transitionsMap[d].fromId===c.id?d.replace(c.id,o):d),Object.keys(e.transitionsMap).forEach(d=>{if(e.transitionsMap[d].fromId===c.id){const T=d.replace(c.id,o);y[T]={...e.transitionsMap[d],id:T,fromId:o}}else y[d]=e.transitionsMap[d]}),e.transitionsMap=y)}return e.trackItemsMap[n]=c,e.trackItemsMap[o]=u,e.trackItemIds.push(o),e.tracks.forEach(m=>{m.items.includes(n)&&m.items.push(o)}),{tracks:e.tracks,trackItemIds:e.trackItemIds,trackItemsMap:e.trackItemsMap,transitionsMap:e.transitionsMap,transitionIds:e.transitionIds}}async function Oa(t,r){const n=C(t).trackItemsMap,i=Object.keys(r);if(!i.length)return{};for(const c of i){const u=r[c];if(u.details&&(n[c].details={...n[c].details,...u.details},u.details.colorMap)){const p=n[c].details.initialSvgString,h=js(p,u.details.colorMap);n[c].details.svgString=h}if(u.metadata&&(n[c].metadata?n[c].metadata={...n[c].metadata,...u.metadata}:n[c].metadata=u.metadata),u.display||u.playbackRate){const p=u.playbackRate,h=n[c].playbackRate||1,m=n[c].display,b=(m.to-m.from)*h/p,T={from:m.from,to:m.from+b};n[c].display=T,n[c].playbackRate=p}u.animations&&(n[c].animations={...n[c].animations,...u.animations})}for(const c of i){const u=r[c];if(n[c].type==="shape"&&u.details.src){const p=await Ie(u.details.src);n[c].details.width=p.width,n[c].details.height=p.height}}const o=K(n);return{trackItemsMap:{...n},duration:o}}async function Da(t,r){const e=C(t),n=Object.keys(r)[0],i=Object.values(r)[0],o=e.trackItemsMap[n],c=o.details;if(!i.details.src)return{};if(o.type==="image"){const u=await Ie(i.details.src),p=o.details.width||0,h=o.details.height||0;let m=u.width,y=u.height;const d=u.width/u.height;p/h>d?(m=p,y=p/d):(y=h,m=h*d),c.crop={x:0,y:0,height:c.height,width:c.width},i.details.width=m,i.details.height=y}else if(o.type==="video"){const u=await Ur(i.details.src),p=o.details.width||0,h=o.details.height||0;let m=u.width,y=u.height;const d=u.width/u.height;p/h>d?(m=p,y=p/d):(y=h,m=h*d),c.crop={x:0,y:0,height:c.height,width:c.width},i.details.width=m,i.details.height=y}return i.details&&(o.details={...c,...i.details},i.details=o.details),e.trackItemsMap[n]={...e.trackItemsMap[n],type:i.type},{trackItemsMap:{...e.trackItemsMap}}}function Ra(t,r){const e=C(t);return e.background.value=r.value,e.background.type=r.type||"color",{...e}}async function Ca(t,r,e={}){const n=C(t),i=r.trackItems.map(b=>Ta(b,{size:n.size})),o=await Promise.all(i),c=ei(r.tracks,r.trackItems),u=[],p=o.map(b=>b.id);r.trackItems.forEach(b=>{if(b.type!=="template")return;n.trackItemsMap={...n.trackItemsMap,...b.trackItemsMap},n.transitionsMap={...n.transitionsMap,...b.transitionsMap};const T={id:b.id,items:b.trackItemIds,transitions:b.transitionsIds||[],tracks:b.tracks};u.push(T)});const h=[],m={};if(o.forEach(b=>{h.push(b.id),m[b.id]=b}),ti(n.tracks,c))n.tracks.forEach(b=>{c.forEach(T=>{b.id===T.id&&(b.magnetic&&rt([b],n.trackItemsMap,p),b.items.push(...h))})});else{const b=e.trackIndex||0,T=Math.min(Math.max(b,0),n.tracks.length);n.tracks.splice(T,0,...c)}n.trackItemsMap={...n.trackItemsMap,...m},n.trackItemIds=[...n.trackItemIds,...h],n.structure=[...n.structure,...u];const d=n.tracks.filter(b=>b.magnetic);return rt(d,n.trackItemsMap,p),n.duration=K(n.trackItemsMap),{trackItemIds:n.trackItemIds,trackItemsMap:n.trackItemsMap,tracks:n.tracks,duration:n.duration,structure:n.structure,transitionIds:n.transitionIds,transitionsMap:n.transitionsMap}}function yt(t,r,e={}){const n=r.map(c=>c.id),i=[],o={};if(r.forEach(c=>{i.push(c.id),o[c.id]=c}),e.targetTrackIndex!==void 0||e.targetTrackId){const c=e.targetTrackIndex||0,u=e.targetTrackId;let p=t.tracks[c];if(u&&(p=t.tracks.find(h=>h.id===u)),!p)throw new Error("Target track not found");p.items.push(...i)}else{const c={id:zs(),accepts:Object.keys(Ns()),type:r[0].type,items:n,magnetic:!1,static:!1};t.tracks.splice(0,0,c)}return t.trackItemsMap={...t.trackItemsMap,...o},t.trackItemIds=[...t.trackItemIds,...i],t}async function Pa(t,r,e={}){const n=C(t),i=[Js(r,{size:n.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio})],o=await Promise.all(i),c=o.map(h=>h.id),u=yt(n,o,e),p=u.tracks.filter(h=>h.magnetic);return rt(p,u.trackItemsMap,c),u.duration=K(u.trackItemsMap),{trackItemIds:u.trackItemIds,trackItemsMap:u.trackItemsMap,tracks:u.tracks,duration:u.duration}}async function xa(t,r,e={}){const n=C(t),i=[Xs(r)],o=await Promise.all(i),c=o.map(h=>h.id),u=yt(n,o,e);u.duration=K(u.trackItemsMap);const p=u.tracks.filter(h=>h.magnetic);return rt(p,u.trackItemsMap,c),{trackItemIds:u.trackItemIds,trackItemsMap:u.trackItemsMap,tracks:u.tracks,duration:u.duration}}async function La(t,r,e={}){const n=C(t),i=[Gs(r,{size:n.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio})],o=await Promise.all(i),c=o.map(h=>h.id),u=yt(n,o,e);u.duration=K(u.trackItemsMap);const p=u.tracks.filter(h=>h.magnetic);return rt(p,u.trackItemsMap,c),{trackItemIds:u.trackItemIds,trackItemsMap:u.trackItemsMap,tracks:u.tracks,duration:u.duration}}async function za(t,r,e={}){const n=C(t),i=[Zs(r,{size:e.size})],o=await Promise.all(i),c=o.map(h=>h.id),u=yt(n,o,e);u.duration=K(u.trackItemsMap);const p=u.tracks.filter(h=>h.magnetic);return rt(p,u.trackItemsMap,c),{trackItemIds:u.trackItemIds,trackItemsMap:u.trackItemsMap,tracks:u.tracks,duration:u.duration}}async function Na(t,r,e={}){const n=C(t),i=[Sa(r,{size:n.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio})],o=await Promise.all(i),c=o.map(h=>h.id),u=yt(n,o,e);u.duration=K(u.trackItemsMap);const p=u.tracks.filter(h=>h.magnetic);return rt(p,u.trackItemsMap,c),{trackItemIds:u.trackItemIds,trackItemsMap:u.trackItemsMap,tracks:u.tracks,duration:u.duration}}async function Fa(t,r,e={}){const n=C(t),i=[Vs(r,{size:n.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio})],o=await Promise.all(i),c=o.map(h=>h.id),u=yt(n,o,e);u.duration=K(u.trackItemsMap);const p=u.tracks.filter(h=>h.magnetic);return rt(p,u.trackItemsMap,c),{trackItemIds:u.trackItemIds,trackItemsMap:u.trackItemsMap,tracks:u.tracks,duration:u.duration}}async function $a(t,r,e={}){const n=C(t),i="composition",o=r.trackItemsMap,c=r.trackItemIds,u=r.tracks||[],{details:p,...h}=await va(r,{size:n.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio}),m={id:h.id,items:c,transitions:[],tracks:u},d=[{...h,type:i,details:p}],b=yt(n,d,e);b.trackItemsMap={...b.trackItemsMap,...o,[h.id]:{...h,type:i,details:p}},b.structure=[...b.structure,m],b.duration=K(b.trackItemsMap);const T=b.tracks.filter(_=>_.magnetic);return rt(T,b.trackItemsMap,[h.id]),{trackItemIds:b.trackItemIds,trackItemsMap:b.trackItemsMap,tracks:b.tracks,duration:b.duration,structure:b.structure}}async function ye(t,r,e={},n){const i=C(t),o=y=>y.display?y.display:{from:0,to:i.duration},c=[];n==="progress-bar"&&c.push(ba(r,{size:i.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio})),n==="progress-frame"&&c.push(_a(r,{size:i.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio})),n==="radial-audio-bars"&&(r.display=o(r),c.push(ka(r,{size:i.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio}))),n==="lineal-audio-bars"&&(r.display=o(r),c.push(Br(r,{size:i.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio}))),n==="wave-audio-bars"&&(r.display=o(r),c.push(Br(r,{size:i.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio}))),n==="hill-audio-bars"&&(r.display=o(r),c.push(Br(r,{size:i.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio})));const u=await Promise.all(c),p=u.map(y=>y.id),h=yt(i,u,e);h.duration=K(h.trackItemsMap);const m=h.tracks.filter(y=>y.magnetic);return rt(m,h.trackItemsMap,p),{trackItemIds:h.trackItemIds,trackItemsMap:h.trackItemsMap,tracks:h.tracks,duration:h.duration}}async function Ha(t,r,e={}){const n=C(t),i="template",o=r.trackItemsMap,c=r.trackItemIds,u=r.transitionsMap,p=r.transitionIds||[],h=r.tracks||[],m=r.structure||[],{details:y,...d}=await Ks(r,{size:n.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio}),b={id:d.id,items:c,transitions:p,tracks:h},_=[{...d,type:i,details:y}],E=yt(n,_,e);E.transitionIds=[...E.transitionIds,...p],E.transitionsMap={...E.transitionsMap,...u},E.trackItemsMap={...E.trackItemsMap,...o,[d.id]:{...d,type:i,details:y}},E.structure=[...E.structure,b,...m],E.duration=K(E.trackItemsMap);const f=E.tracks.filter(I=>I.magnetic);return rt(f,E.trackItemsMap,[d.id]),{trackItemIds:E.trackItemIds,trackItemsMap:E.trackItemsMap,tracks:E.tracks,duration:E.duration,structure:E.structure,transitionsMap:E.transitionsMap}}async function Ua(t,r,e={}){const n=C(t),i=r.trackItems.map(y=>qs(y,{size:e.size})),o=await Promise.all(i),c=ei(r.tracks,r.trackItems),u=[],p={};if(o.forEach(y=>{const{details:d,...b}=y;u.push(y.id),p[y.id]=b}),ti(n.tracks,c))n.tracks.forEach(y=>{c.forEach(d=>{y.id===d.id&&(y.magnetic&&rt([y],n.trackItemsMap,u),y.items.push(...u))})});else{const y=e.trackIndex||0,d=Math.min(Math.max(y,0),n.tracks.length);n.tracks.splice(d,0,...c)}n.trackItemsMap={...n.trackItemsMap,...p},n.trackItemIds=[...n.trackItemIds,...u],n.duration=K(n.trackItemsMap);const m=n.tracks.filter(y=>y.magnetic);return rt(m,n.trackItemsMap,u),{trackItemIds:n.trackItemIds,trackItemsMap:n.trackItemsMap,tracks:n.tracks,duration:n.duration}}async function ja(t,r){const e=C(t),n=e.trackItemsMap[r.id],i=[];if(!n)return{};let o=n.animations||{};return r.animations.loop?r.animations.loop.composition.forEach(c=>{var u;(u=c.details)!=null&&u.fonts&&i.push(...c.details.fonts)}):r.animations.in?r.animations.in.composition.forEach(c=>{var u;(u=c.details)!=null&&u.fonts&&i.push(...c.details.fonts)}):r.animations.out&&r.animations.out.composition.forEach(c=>{var u;(u=c.details)!=null&&u.fonts&&i.push(...c.details.fonts)}),i.length>0&&await $e(i),o.in&&r.animations.in?o.in=r.animations.in:o.out&&r.animations.out?o.out=r.animations.out:o.loop&&r.animations.loop?o.loop=r.animations.loop:!o.out&&r.animations.out?o.out=r.animations.out:!o.in&&r.animations.in?o.in=r.animations.in:!o.loop&&r.animations.loop?o.loop=r.animations.loop:o=r.animations,n.animations=o,{trackItemsMap:e.trackItemsMap}}async function Ba(t,r,e={}){const n=C(t),i=[Ea(r,{size:n.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio})],o=await Promise.all(i),c=o.map(h=>h.id),u=yt(n,o,e);u.duration=K(u.trackItemsMap);const p=u.tracks.filter(h=>h.magnetic);return rt(p,u.trackItemsMap,c),{trackItemIds:u.trackItemIds,trackItemsMap:u.trackItemsMap,tracks:u.tracks,duration:u.duration}}function Ya(t){const r=H.subject.pipe(H.filter(({key:f})=>f.startsWith(Fr))),e=H.subject.pipe(H.filter(({key:f})=>f.startsWith(dr))),n=H.subject.pipe(H.filter(({key:f})=>f.startsWith(U))),i=H.subject.pipe(H.filter(({key:f})=>f.startsWith(X))),o=H.subject.pipe(H.filter(({key:f})=>f.startsWith(Fe))),c=H.subject.pipe(H.filter(({key:f})=>f.startsWith(Wt))),u=H.subject.pipe(H.filter(({key:f})=>f.startsWith(Et))),p=H.subject.pipe(H.filter(({key:f})=>f.startsWith($r))),h=r.subscribe(async f=>{var I;if(f.key===Fr){const{actions:k}=(I=f.value)==null?void 0:I.payload;k.forEach(v=>{H.dispatch(v.type,v.payload&&{payload:v.payload})})}}),m=e.subscribe(async f=>{var I,k;if(f.key===ns){const v=(I=f.value)==null?void 0:I.payload,w=await Aa(t.getState(),v);t.updateState(w,{kind:"design:load",updateHistory:!1})}if(f.key===ss){const v=(k=f.value)==null?void 0:k.payload;t.updateState({size:v},{kind:"design:resize",updateHistory:!1})}}),y=o.subscribe(f=>{if(f.key===Ps)return t.undo();if(f.key===xs)return t.redo()}),d=p.subscribe(f=>{var I;if(f.key===Ls){const k=(I=f.value)==null?void 0:I.payload.scale;t.updateState({scale:k},{kind:"update",updateHistory:!1})}}),b=i.subscribe(async f=>{var I,k,v,w;if(f.key===Ms){const M=((I=f.value)==null?void 0:I.payload.trackItemIds)||[];t.updateState({activeIds:M},{kind:"update",updateHistory:!1})}if(f.key===Os&&wa(t.getState()),f.key===Rs){const M=(k=f.value)==null?void 0:k.payload.trackItemIds,A=ua(t.getState(),M);t.updateState(A,{updateHistory:!0,kind:"remove"})}if(f.key===Ds){const M=ma(t.getState(),(v=f.value)==null?void 0:v.payload.trackItemIds);t.updateState(M,{updateHistory:!0,kind:"update"})}if(f.key===Cs){const M=(w=f.value)==null?void 0:w.payload,A=await ha(t.getState(),M);t.updateState(A,{updateHistory:!0,kind:"update:details"})}}),T=n.subscribe(async f=>{var j,P,Z,D,F,nt,Zt,Qt,be,_e,ke,ve,z,Se,Ee,at,te,N,ee,Te,ot,re,ne,Lt,zt,se,Nt,ie,Ft,ae,Ae,we,Tt,$t,oe,ce,ft,At,Me,bt,wt,Ht,st,ue,le,Oe,Ut,Mt;const I=C(t.getState()),k=((P=(j=f.value)==null?void 0:j.options)==null?void 0:P.isSelected)||!1,v=(D=(Z=f.value)==null?void 0:Z.options)==null?void 0:D.scaleMode,w=(nt=(F=f.value)==null?void 0:F.options)==null?void 0:nt.scaleAspectRatio,M=(Qt=(Zt=f.value)==null?void 0:Zt.options)==null?void 0:Qt.trackIndex;let A={};f.key===ds?A=await ja(I,(be=f.value)==null?void 0:be.payload):f.key===hs?A=await Ca(I,(_e=f.value)==null?void 0:_e.payload,{trackIndex:M}):f.key===fs?A=await Ua(I,(ke=f.value)==null?void 0:ke.payload,{trackIndex:M}):f.key===is?A=await za(I,(ve=f.value)==null?void 0:ve.payload,{targetTrackIndex:M,targetTrackId:(z=f.value)==null?void 0:z.options.targetTrackId,size:I.size}):f.key===ps?A=await Ha(I,(Se=f.value)==null?void 0:Se.payload,{scaleMode:v,scaleAspectRatio:w,targetTrackIndex:M,targetTrackId:(at=(Ee=f.value)==null?void 0:Ee.options)==null?void 0:at.targetTrackId}):f.key===us?A=await Fa(I,(te=f.value)==null?void 0:te.payload,{scaleMode:v,scaleAspectRatio:w,targetTrackIndex:M,targetTrackId:(N=f.value)==null?void 0:N.options.targetTrackId}):f.key===ls?A=await Na(I,(ee=f.value)==null?void 0:ee.payload,{scaleMode:v,scaleAspectRatio:w,targetTrackIndex:M,targetTrackId:(Te=f.value)==null?void 0:Te.options.targetTrackId}):f.key===vs?A=await Ba(I,(ot=f.value)==null?void 0:ot.payload,{scaleMode:v,scaleAspectRatio:w,targetTrackIndex:M,targetTrackId:(re=f.value)==null?void 0:re.options.targetTrackId}):f.key===cs?A=await Pa(I,(ne=f.value)==null?void 0:ne.payload,{scaleMode:v,scaleAspectRatio:w,targetTrackIndex:M,targetTrackId:(Lt=f.value)==null?void 0:Lt.options.targetTrackId}):f.key===os?A=await xa(I,(zt=f.value)==null?void 0:zt.payload,{targetTrackIndex:M,targetTrackId:(se=f.value)==null?void 0:se.options.targetTrackId}):f.key===as?A=await La(I,(Nt=f.value)==null?void 0:Nt.payload,{scaleMode:v,scaleAspectRatio:w,targetTrackIndex:M,targetTrackId:(ie=f.value)==null?void 0:ie.options.targetTrackId}):f.key===ms?A=await $a(I,(Ft=f.value)==null?void 0:Ft.payload,{scaleMode:v,scaleAspectRatio:w,targetTrackIndex:M,targetTrackId:(ae=f.value)==null?void 0:ae.options.targetTrackId}):f.key===gs?A=await ye(I,(Ae=f.value)==null?void 0:Ae.payload,{targetTrackIndex:M,targetTrackId:(Tt=(we=f.value)==null?void 0:we.options)==null?void 0:Tt.targetTrackId},"progress-bar"):f.key===Is?A=await ye(I,($t=f.value)==null?void 0:$t.payload,{targetTrackIndex:M,targetTrackId:(ce=(oe=f.value)==null?void 0:oe.options)==null?void 0:ce.targetTrackId},"progress-frame"):f.key===ys?A=await ye(I,(ft=f.value)==null?void 0:ft.payload,{targetTrackIndex:M,targetTrackId:(Me=(At=f.value)==null?void 0:At.options)==null?void 0:Me.targetTrackId},"radial-audio-bars"):f.key===bs?A=await ye(I,(bt=f.value)==null?void 0:bt.payload,{targetTrackIndex:M,targetTrackId:(Ht=(wt=f.value)==null?void 0:wt.options)==null?void 0:Ht.targetTrackId},"lineal-audio-bars"):f.key===_s?A=await ye(I,(st=f.value)==null?void 0:st.payload,{targetTrackIndex:M,targetTrackId:(le=(ue=f.value)==null?void 0:ue.options)==null?void 0:le.targetTrackId},"wave-audio-bars"):f.key===ks&&(A=await ye(I,(Oe=f.value)==null?void 0:Oe.payload,{targetTrackIndex:M,targetTrackId:(Mt=(Ut=f.value)==null?void 0:Ut.options)==null?void 0:Mt.targetTrackId},"hill-audio-bars")),k&&A.trackItemIds&&(A.activeIds=A.trackItemIds),t.updateState(A,{updateHistory:!0,kind:"add"})}),_=c.subscribe(async f=>{var I;if(f.key===ws){const k=(I=f.value)==null?void 0:I.options.time,v=Ma(t.getState(),k);Object.keys(v).length>0&&t.updateState(v,{updateHistory:!0,kind:"update"})}if(f.key===As){const k=await da(t.getState());t.updateState(k,{updateHistory:!0,kind:"update"})}}),E=u.subscribe(async f=>{var I,k,v;if(f.key===Ss){const w=await Oa(t.getState(),(I=f.value)==null?void 0:I.payload);t.updateState(w,{updateHistory:!0,kind:"update:details"})}if(f.key===Es){const w=await Da(t.getState(),(k=f.value)==null?void 0:k.payload);t.updateState(w,{updateHistory:!0,kind:"update:details"})}if(f.key===Ts){const w=Ra(t.getState(),(v=f.value)==null?void 0:v.payload);t.updateState(w,{updateHistory:!0,kind:"update:details"})}});return{unsubscribe:()=>{T.unsubscribe(),_.unsubscribe(),E.unsubscribe(),y.unsubscribe(),b.unsubscribe(),m.unsubscribe(),d.unsubscribe(),h.unsubscribe()}}}const Wa={Date:!0,RegExp:!0,String:!0,Number:!0};function ri(t,r,e={cyclesFix:!0},n=[]){var u,p;let i=[];const o=Array.isArray(t);for(const h in t){const m=t[h],y=o?+h:h;if(!(h in r)){i.push({type:"REMOVE",path:[y],oldValue:t[h]});continue}const d=r[h],b=typeof m=="object"&&typeof d=="object"&&Array.isArray(m)===Array.isArray(d);m&&d&&b&&!Wa[(p=(u=Object.getPrototypeOf(m))==null?void 0:u.constructor)==null?void 0:p.name]&&(!e.cyclesFix||!n.includes(m))?i.push.apply(i,ri(m,d,e,e.cyclesFix?n.concat([m]):[]).map(T=>(T.path.unshift(y),T))):m!==d&&!(Number.isNaN(m)&&Number.isNaN(d))&&!(b&&(isNaN(m)?m+""==d+"":+m==+d))&&i.push({path:[y],type:"CHANGE",value:d,oldValue:m})}const c=Array.isArray(r);for(const h in r)h in t||i.push({type:"CREATE",path:[c?+h:h],value:r[h]});return i}var Yr=Symbol.for("immer-nothing"),je=Symbol.for("immer-draftable"),lt=Symbol.for("immer-state"),ni=process.env.NODE_ENV!=="production"?[function(t){return`The plugin for '${t}' has not been loaded into Immer. To enable the plugin, import and call \`enable${t}()\` when initializing your application.`},function(t){return`produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '${t}'`},"This object has been frozen and should not be mutated",function(t){return"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+t},"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.","Immer forbids circular references","The first or second argument to `produce` must be a function","The third argument to `produce` must be a function or undefined","First argument to `createDraft` must be a plain object, an array, or an immerable object","First argument to `finishDraft` must be a draft returned by `createDraft`",function(t){return`'current' expects a draft, got: ${t}`},"Object.defineProperty() cannot be used on an Immer draft","Object.setPrototypeOf() cannot be used on an Immer draft","Immer only supports deleting array indices","Immer only supports setting array indices and the 'length' property",function(t){return`'original' expects a draft, got: ${t}`}]:[];function W(t,...r){if(process.env.NODE_ENV!=="production"){const e=ni[t],n=typeof e=="function"?e.apply(null,r):e;throw new Error(`[Immer] ${n}`)}throw new Error(`[Immer] minified error nr: ${t}. Full error at: https://bit.ly/3cXEKWf`)}var Xt=Object.getPrototypeOf;function Kt(t){return!!t&&!!t[lt]}function xt(t){var r;return t?si(t)||Array.isArray(t)||!!t[je]||!!((r=t.constructor)!=null&&r[je])||We(t)||Ge(t):!1}var Ga=Object.prototype.constructor.toString();function si(t){if(!t||typeof t!="object")return!1;const r=Xt(t);if(r===null)return!0;const e=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return e===Object?!0:typeof e=="function"&&Function.toString.call(e)===Ga}function Be(t,r){Vt(t)===0?Reflect.ownKeys(t).forEach(e=>{r(e,t[e],t)}):t.forEach((e,n)=>r(n,e,t))}function Vt(t){const r=t[lt];return r?r.type_:Array.isArray(t)?1:We(t)?2:Ge(t)?3:0}function Ye(t,r){return Vt(t)===2?t.has(r):Object.prototype.hasOwnProperty.call(t,r)}function Wr(t,r){return Vt(t)===2?t.get(r):t[r]}function ii(t,r,e){const n=Vt(t);n===2?t.set(r,e):n===3?t.add(e):t[r]=e}function Xa(t,r){return t===r?t!==0||1/t===1/r:t!==t&&r!==r}function We(t){return t instanceof Map}function Ge(t){return t instanceof Set}function Jt(t){return t.copy_||t.base_}function Gr(t,r){if(We(t))return new Map(t);if(Ge(t))return new Set(t);if(Array.isArray(t))return Array.prototype.slice.call(t);const e=si(t);if(r===!0||r==="class_only"&&!e){const n=Object.getOwnPropertyDescriptors(t);delete n[lt];let i=Reflect.ownKeys(n);for(let o=0;o<i.length;o++){const c=i[o],u=n[c];u.writable===!1&&(u.writable=!0,u.configurable=!0),(u.get||u.set)&&(n[c]={configurable:!0,writable:!0,enumerable:u.enumerable,value:t[c]})}return Object.create(Xt(t),n)}else{const n=Xt(t);if(n!==null&&e)return{...t};const i=Object.create(n);return Object.assign(i,t)}}function Xr(t,r=!1){return hr(t)||Kt(t)||!xt(t)||(Vt(t)>1&&(t.set=t.add=t.clear=t.delete=Ka),Object.freeze(t),r&&Object.entries(t).forEach(([e,n])=>Xr(n,!0))),t}function Ka(){W(2)}function hr(t){return Object.isFrozen(t)}var Kr={};function qt(t){const r=Kr[t];return r||W(0,t),r}function Va(t,r){Kr[t]||(Kr[t]=r)}var Xe;function ai(){return Xe}function Ja(t,r){return{drafts_:[],parent_:t,immer_:r,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function oi(t,r){r&&(qt("Patches"),t.patches_=[],t.inversePatches_=[],t.patchListener_=r)}function Vr(t){Jr(t),t.drafts_.forEach(qa),t.drafts_=null}function Jr(t){t===Xe&&(Xe=t.parent_)}function ci(t){return Xe=Ja(Xe,t)}function qa(t){const r=t[lt];r.type_===0||r.type_===1?r.revoke_():r.revoked_=!0}function ui(t,r){r.unfinalizedDrafts_=r.drafts_.length;const e=r.drafts_[0];return t!==void 0&&t!==e?(e[lt].modified_&&(Vr(r),W(4)),xt(t)&&(t=mr(r,t),r.parent_||gr(r,t)),r.patches_&&qt("Patches").generateReplacementPatches_(e[lt].base_,t,r.patches_,r.inversePatches_)):t=mr(r,e,[]),Vr(r),r.patches_&&r.patchListener_(r.patches_,r.inversePatches_),t!==Yr?t:void 0}function mr(t,r,e){if(hr(r))return r;const n=r[lt];if(!n)return Be(r,(i,o)=>li(t,n,r,i,o,e)),r;if(n.scope_!==t)return r;if(!n.modified_)return gr(t,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;const i=n.copy_;let o=i,c=!1;n.type_===3&&(o=new Set(i),i.clear(),c=!0),Be(o,(u,p)=>li(t,n,i,u,p,e,c)),gr(t,i,!1),e&&t.patches_&&qt("Patches").generatePatches_(n,e,t.patches_,t.inversePatches_)}return n.copy_}function li(t,r,e,n,i,o,c){if(process.env.NODE_ENV!=="production"&&i===e&&W(5),Kt(i)){const u=o&&r&&r.type_!==3&&!Ye(r.assigned_,n)?o.concat(n):void 0,p=mr(t,i,u);if(ii(e,n,p),Kt(p))t.canAutoFreeze_=!1;else return}else c&&e.add(i);if(xt(i)&&!hr(i)){if(!t.immer_.autoFreeze_&&t.unfinalizedDrafts_<1)return;mr(t,i),(!r||!r.scope_.parent_)&&typeof n!="symbol"&&Object.prototype.propertyIsEnumerable.call(e,n)&&gr(t,i)}}function gr(t,r,e=!1){!t.parent_&&t.immer_.autoFreeze_&&t.canAutoFreeze_&&Xr(r,e)}function Za(t,r){const e=Array.isArray(t),n={type_:e?1:0,scope_:r?r.scope_:ai(),modified_:!1,finalized_:!1,assigned_:{},parent_:r,base_:t,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=n,o=qr;e&&(i=[n],o=Ke);const{revoke:c,proxy:u}=Proxy.revocable(i,o);return n.draft_=u,n.revoke_=c,u}var qr={get(t,r){if(r===lt)return t;const e=Jt(t);if(!Ye(e,r))return Qa(t,e,r);const n=e[r];return t.finalized_||!xt(n)?n:n===Zr(t.base_,r)?(tn(t),t.copy_[r]=en(n,t)):n},has(t,r){return r in Jt(t)},ownKeys(t){return Reflect.ownKeys(Jt(t))},set(t,r,e){const n=di(Jt(t),r);if(n!=null&&n.set)return n.set.call(t.draft_,e),!0;if(!t.modified_){const i=Zr(Jt(t),r),o=i==null?void 0:i[lt];if(o&&o.base_===e)return t.copy_[r]=e,t.assigned_[r]=!1,!0;if(Xa(e,i)&&(e!==void 0||Ye(t.base_,r)))return!0;tn(t),Qr(t)}return t.copy_[r]===e&&(e!==void 0||r in t.copy_)||Number.isNaN(e)&&Number.isNaN(t.copy_[r])||(t.copy_[r]=e,t.assigned_[r]=!0),!0},deleteProperty(t,r){return Zr(t.base_,r)!==void 0||r in t.base_?(t.assigned_[r]=!1,tn(t),Qr(t)):delete t.assigned_[r],t.copy_&&delete t.copy_[r],!0},getOwnPropertyDescriptor(t,r){const e=Jt(t),n=Reflect.getOwnPropertyDescriptor(e,r);return n&&{writable:!0,configurable:t.type_!==1||r!=="length",enumerable:n.enumerable,value:e[r]}},defineProperty(){W(11)},getPrototypeOf(t){return Xt(t.base_)},setPrototypeOf(){W(12)}},Ke={};Be(qr,(t,r)=>{Ke[t]=function(){return arguments[0]=arguments[0][0],r.apply(this,arguments)}}),Ke.deleteProperty=function(t,r){return process.env.NODE_ENV!=="production"&&isNaN(parseInt(r))&&W(13),Ke.set.call(this,t,r,void 0)},Ke.set=function(t,r,e){return process.env.NODE_ENV!=="production"&&r!=="length"&&isNaN(parseInt(r))&&W(14),qr.set.call(this,t[0],r,e,t[0])};function Zr(t,r){const e=t[lt];return(e?Jt(e):t)[r]}function Qa(t,r,e){var i;const n=di(r,e);return n?"value"in n?n.value:(i=n.get)==null?void 0:i.call(t.draft_):void 0}function di(t,r){if(!(r in t))return;let e=Xt(t);for(;e;){const n=Object.getOwnPropertyDescriptor(e,r);if(n)return n;e=Xt(e)}}function Qr(t){t.modified_||(t.modified_=!0,t.parent_&&Qr(t.parent_))}function tn(t){t.copy_||(t.copy_=Gr(t.base_,t.scope_.immer_.useStrictShallowCopy_))}var to=class{constructor(t){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(r,e,n)=>{if(typeof r=="function"&&typeof e!="function"){const o=e;e=r;const c=this;return function(p=o,...h){return c.produce(p,m=>e.call(this,m,...h))}}typeof e!="function"&&W(6),n!==void 0&&typeof n!="function"&&W(7);let i;if(xt(r)){const o=ci(this),c=en(r,void 0);let u=!0;try{i=e(c),u=!1}finally{u?Vr(o):Jr(o)}return oi(o,n),ui(i,o)}else if(!r||typeof r!="object"){if(i=e(r),i===void 0&&(i=r),i===Yr&&(i=void 0),this.autoFreeze_&&Xr(i,!0),n){const o=[],c=[];qt("Patches").generateReplacementPatches_(r,i,o,c),n(o,c)}return i}else W(1,r)},this.produceWithPatches=(r,e)=>{if(typeof r=="function")return(c,...u)=>this.produceWithPatches(c,p=>r(p,...u));let n,i;return[this.produce(r,e,(c,u)=>{n=c,i=u}),n,i]},typeof(t==null?void 0:t.autoFreeze)=="boolean"&&this.setAutoFreeze(t.autoFreeze),typeof(t==null?void 0:t.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(t.useStrictShallowCopy)}createDraft(t){xt(t)||W(8),Kt(t)&&(t=eo(t));const r=ci(this),e=en(t,void 0);return e[lt].isManual_=!0,Jr(r),e}finishDraft(t,r){const e=t&&t[lt];(!e||!e.isManual_)&&W(9);const{scope_:n}=e;return oi(n,r),ui(void 0,n)}setAutoFreeze(t){this.autoFreeze_=t}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t}applyPatches(t,r){let e;for(e=r.length-1;e>=0;e--){const i=r[e];if(i.path.length===0&&i.op==="replace"){t=i.value;break}}e>-1&&(r=r.slice(e+1));const n=qt("Patches").applyPatches_;return Kt(t)?n(t,r):this.produce(t,i=>n(i,r))}};function en(t,r){const e=We(t)?qt("MapSet").proxyMap_(t,r):Ge(t)?qt("MapSet").proxySet_(t,r):Za(t,r);return(r?r.scope_:ai()).drafts_.push(e),e}function eo(t){return Kt(t)||W(10,t),fi(t)}function fi(t){if(!xt(t)||hr(t))return t;const r=t[lt];let e;if(r){if(!r.modified_)return r.base_;r.finalized_=!0,e=Gr(t,r.scope_.immer_.useStrictShallowCopy_)}else e=Gr(t,!0);return Be(e,(n,i)=>{ii(e,n,fi(i))}),r&&(r.finalized_=!1),e}function pi(){process.env.NODE_ENV!=="production"&&ni.push('Sets cannot have "replace" patches.',function(d){return"Unsupported patch operation: "+d},function(d){return"Cannot apply patch, path doesn't resolve: "+d},"Patching reserved attributes like __proto__, prototype and constructor is not allowed");const r="replace",e="add",n="remove";function i(d,b,T,_){switch(d.type_){case 0:case 2:return c(d,b,T,_);case 1:return o(d,b,T,_);case 3:return u(d,b,T,_)}}function o(d,b,T,_){let{base_:E,assigned_:f}=d,I=d.copy_;I.length<E.length&&([E,I]=[I,E],[T,_]=[_,T]);for(let k=0;k<E.length;k++)if(f[k]&&I[k]!==E[k]){const v=b.concat([k]);T.push({op:r,path:v,value:y(I[k])}),_.push({op:r,path:v,value:y(E[k])})}for(let k=E.length;k<I.length;k++){const v=b.concat([k]);T.push({op:e,path:v,value:y(I[k])})}for(let k=I.length-1;E.length<=k;--k){const v=b.concat([k]);_.push({op:n,path:v})}}function c(d,b,T,_){const{base_:E,copy_:f}=d;Be(d.assigned_,(I,k)=>{const v=Wr(E,I),w=Wr(f,I),M=k?Ye(E,I)?r:e:n;if(v===w&&M===r)return;const A=b.concat(I);T.push(M===n?{op:M,path:A}:{op:M,path:A,value:w}),_.push(M===e?{op:n,path:A}:M===n?{op:e,path:A,value:y(v)}:{op:r,path:A,value:y(v)})})}function u(d,b,T,_){let{base_:E,copy_:f}=d,I=0;E.forEach(k=>{if(!f.has(k)){const v=b.concat([I]);T.push({op:n,path:v,value:k}),_.unshift({op:e,path:v,value:k})}I++}),I=0,f.forEach(k=>{if(!E.has(k)){const v=b.concat([I]);T.push({op:e,path:v,value:k}),_.unshift({op:n,path:v,value:k})}I++})}function p(d,b,T,_){T.push({op:r,path:[],value:b===Yr?void 0:b}),_.push({op:r,path:[],value:d})}function h(d,b){return b.forEach(T=>{const{path:_,op:E}=T;let f=d;for(let w=0;w<_.length-1;w++){const M=Vt(f);let A=_[w];typeof A!="string"&&typeof A!="number"&&(A=""+A),(M===0||M===1)&&(A==="__proto__"||A==="constructor")&&W(19),typeof f=="function"&&A==="prototype"&&W(19),f=Wr(f,A),typeof f!="object"&&W(18,_.join("/"))}const I=Vt(f),k=m(T.value),v=_[_.length-1];switch(E){case r:switch(I){case 2:return f.set(v,k);case 3:W(16);default:return f[v]=k}case e:switch(I){case 1:return v==="-"?f.push(k):f.splice(v,0,k);case 2:return f.set(v,k);case 3:return f.add(k);default:return f[v]=k}case n:switch(I){case 1:return f.splice(v,1);case 2:return f.delete(v);case 3:return f.delete(T.value);default:return delete f[v]}default:W(17,E)}}),d}function m(d){if(!xt(d))return d;if(Array.isArray(d))return d.map(m);if(We(d))return new Map(Array.from(d.entries()).map(([T,_])=>[T,m(_)]));if(Ge(d))return new Set(Array.from(d).map(m));const b=Object.create(Xt(d));for(const T in d)b[T]=m(d[T]);return Ye(d,je)&&(b[je]=d[je]),b}function y(d){return Kt(d)?m(d):d}Va("Patches",{applyPatches_:h,generatePatches_:i,generateReplacementPatches_:p})}var dt=new to,ro=dt.produce;dt.produceWithPatches.bind(dt),dt.setAutoFreeze.bind(dt),dt.setUseStrictShallowCopy.bind(dt);var no=dt.applyPatches.bind(dt);dt.createDraft.bind(dt),dt.finishDraft.bind(dt);var so=9007199254740991,io="[object Arguments]",ao="[object Function]",oo="[object GeneratorFunction]",co="[object Symbol]",uo=typeof pt=="object"&&pt&&pt.Object===Object&&pt,lo=typeof self=="object"&&self&&self.Object===Object&&self,fo=uo||lo||Function("return this")();function po(t,r,e){switch(e.length){case 0:return t.call(r);case 1:return t.call(r,e[0]);case 2:return t.call(r,e[0],e[1]);case 3:return t.call(r,e[0],e[1],e[2])}return t.apply(r,e)}function ho(t,r){for(var e=-1,n=t?t.length:0,i=Array(n);++e<n;)i[e]=r(t[e],e,t);return i}function mo(t,r){for(var e=-1,n=r.length,i=t.length;++e<n;)t[i+e]=r[e];return t}var rn=Object.prototype,go=rn.hasOwnProperty,nn=rn.toString,hi=fo.Symbol,Io=rn.propertyIsEnumerable,mi=hi?hi.isConcatSpreadable:void 0,gi=Math.max;function yo(t,r,e,n,i){var o=-1,c=t.length;for(e||(e=vo),i||(i=[]);++o<c;){var u=t[o];e(u)?mo(i,u):i[i.length]=u}return i}function bo(t,r){return t=Object(t),_o(t,r,function(e,n){return n in t})}function _o(t,r,e){for(var n=-1,i=r.length,o={};++n<i;){var c=r[n],u=t[c];e(u,c)&&(o[c]=u)}return o}function ko(t,r){return r=gi(r===void 0?t.length-1:r,0),function(){for(var e=arguments,n=-1,i=gi(e.length-r,0),o=Array(i);++n<i;)o[n]=e[r+n];n=-1;for(var c=Array(r+1);++n<r;)c[n]=e[n];return c[r]=o,po(t,this,c)}}function vo(t){return To(t)||Eo(t)||!!(mi&&t&&t[mi])}function So(t){if(typeof t=="string"||Ro(t))return t;var r=t+"";return r=="0"&&1/t==-1/0?"-0":r}function Eo(t){return wo(t)&&go.call(t,"callee")&&(!Io.call(t,"callee")||nn.call(t)==io)}var To=Array.isArray;function Ao(t){return t!=null&&Oo(t.length)&&!Mo(t)}function wo(t){return Ii(t)&&Ao(t)}function Mo(t){var r=Do(t)?nn.call(t):"";return r==ao||r==oo}function Oo(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=so}function Do(t){var r=typeof t;return!!t&&(r=="object"||r=="function")}function Ii(t){return!!t&&typeof t=="object"}function Ro(t){return typeof t=="symbol"||Ii(t)&&nn.call(t)==co}var Co=ko(function(t,r){return t==null?{}:bo(t,ho(yo(r),So))}),Po=Co;const yi=Nr(Po),xo={size:{width:1080,height:1920},fps:30,tracks:[],trackItemIds:[],trackItemsMap:{},transitionIds:[],transitionsMap:{},scale:{index:7,unit:300,zoom:1/300,segments:5},duration:0,activeIds:[],structure:[],background:{type:"color",value:"transparent"}},bi=["tracks","trackItemsMap","transitionIds","transitionsMap","trackItemIds","structure"];class Lo{constructor(r,e){Yt(this,"stateSubject");Yt(this,"stateHistorySubject");Yt(this,"prevState");Yt(this,"background");Yt(this,"undos",[]);Yt(this,"redos",[]);Yt(this,"listener");const n=Object.assign({},xo,r,e!=null&&e.scale?{scale:e.scale}:{});this.stateSubject=new Zn(n),this.stateHistorySubject=new Zn({handleRedo:!1,handleUndo:!1}),this.background=n.background,this.prevState=n,(e!=null&&e.cors||e!=null&&e.acceptsMap)&&fa({cors:e.cors,acceptsMap:e.acceptsMap}),this.initListeners()}initListeners(){Ya(this)}destroyListeners(){this.listener&&this.listener.unsubscribe()}purge(){this.destroyListeners()}updateHistory(r,e){const n=yi(r,bi),i=yi(this.getState(),bi),o=ri(i,n);o.length&&(this.undos.push({undos:o,type:e}),this.redos=[])}getStateHistory(){return this.stateHistorySubject.getValue()}subscribeHistory(r){return this.stateHistorySubject.subscribe(r)}getState(){return this.stateSubject.getValue()}subscribe(r){return this.stateSubject.subscribe(r)}updateState(r,e={updateHistory:!1}){const n=this.getState(),i={...C(n),...C(r)};Y(n,i)||(e.updateHistory&&this.updateHistory(i,e.kind),this.prevState=n,this.stateSubject.next(i))}subscribeToUpdateStateDetails(r){return this.stateSubject.asObservable().subscribe(e=>{(!Y(e.size,this.prevState.size)||!Y(e.background,this.prevState.background))&&r({size:e.size,background:e.background})})}subscribeToScale(r){return this.stateSubject.asObservable().subscribe(e=>{Y(e.scale,this.prevState.scale)||r({scale:e.scale})})}subscribeToFps(r){return this.stateSubject.asObservable().subscribe(e=>{e.fps!==this.prevState.fps&&r({fps:e.fps})})}subscribeToUpdateTrackItem(r){return this.stateSubject.asObservable().subscribe(e=>{Y(e.trackItemsMap,this.prevState.trackItemsMap)||r({trackItemsMap:e.trackItemsMap})})}subscribeToUpdateAnimations(r){return this.stateSubject.asObservable().subscribe(e=>{const n=Object.keys(e.trackItemsMap).filter(i=>{const o=this.prevState.trackItemsMap[i],c=e.trackItemsMap[i];return o&&c&&!Y(o.animations,c.animations)});r({trackItemsMap:e.trackItemsMap,changedAnimationIds:n})})}subscribeToUpdateTrackItemTiming(r){return this.stateSubject.asObservable().subscribe(e=>{if(!Y(e.trackItemsMap,this.prevState.trackItemsMap)){const n=Object.keys(e.trackItemsMap).filter(o=>{const c=this.prevState.trackItemsMap[o],u=e.trackItemsMap[o];return c&&u&&!Y(c.trim,u.trim)}),i=Object.keys(e.trackItemsMap).filter(o=>{const c=this.prevState.trackItemsMap[o],u=e.trackItemsMap[o];return c&&u&&!Y(c.display,u.display)});r({trackItemsMap:e.trackItemsMap,changedTrimIds:n.length>0?n:void 0,changedDisplayIds:i.length>0?i:void 0})}})}subscribeToUpdateItemDetails(r){return this.stateSubject.asObservable().subscribe(e=>{Object.keys(e.trackItemsMap).some(i=>{const o=this.prevState.trackItemsMap[i],c=e.trackItemsMap[i];return o&&c&&!Y(o.details,c.details)})&&r({trackItemsMap:e.trackItemsMap})})}subscribeToDuration(r){return this.stateSubject.asObservable().subscribe(e=>{e.duration!==this.prevState.duration&&r({duration:e.duration})})}subscribeToHistory(r){return this.stateHistorySubject.asObservable().subscribe(e=>{if(e.handleRedo){const n=this.undos[this.undos.length-1].type;r({...this.getState(),type:n}),this.stateHistorySubject.next({handleRedo:!1,handleUndo:!1})}if(e.handleUndo){const n=this.redos[this.redos.length-1].type;r({...this.getState(),type:n}),this.stateHistorySubject.next({handleRedo:!1,handleUndo:!1})}})}subscribeToAddOrRemoveItems(r){return this.stateSubject.asObservable().subscribe(e=>{const n=[...e.trackItemIds].sort(),i=[...this.prevState.trackItemIds].sort(),o=[...e.transitionIds].sort(),c=[...this.prevState.transitionIds].sort();(!Y(n,i)||!Y(o,c))&&r({trackItemIds:e.trackItemIds})})}subscribeToActiveIds(r){return this.stateSubject.asObservable().subscribe(e=>{Y(e.activeIds,this.prevState.activeIds)||r({activeIds:e.activeIds})})}subscribeToTracks(r){return this.stateSubject.asObservable().subscribe(e=>{const n=e.tracks,o=this.prevState.tracks.map(u=>u.id),c=n.filter(u=>!o.includes(u.id));c.length&&r({tracks:e.tracks,changedTracks:c.map(u=>u.id)})})}subscribeToState(r){return this.stateSubject.asObservable().subscribe(e=>{(!Y(e.tracks,this.prevState.tracks)||!Y(e.trackItemIds,this.prevState.trackItemIds)||!Y(e.trackItemsMap,this.prevState.trackItemsMap)||!Y(e.transitionIds,this.prevState.transitionIds)||!Y(e.transitionsMap,this.prevState.transitionsMap)||!Y(e.structure,this.prevState.structure))&&r({tracks:e.tracks,trackItemIds:e.trackItemIds,trackItemsMap:e.trackItemsMap,transitionIds:e.transitionIds,transitionsMap:e.transitionsMap,structure:e.structure})})}undo(){const r=this.undos.pop(),e=r==null?void 0:r.undos,n=r==null?void 0:r.type;if(!e||!n)return;pi();const{trackItemIds:i,tracks:o,transitionIds:c,transitionsMap:u,trackItemsMap:p,structure:h}=this.getState(),m=C({trackItemIds:i,tracks:o,transitionIds:c,transitionsMap:u,trackItemsMap:p,structure:h}),y=[],d=[],b=[],T=[],_=[],E=[];e.forEach(D=>{let F;const nt=D.path.slice(1);D.type==="CREATE"?F={path:nt,op:"remove",value:D.value}:D.type==="CHANGE"?F={path:nt,op:"replace",value:D.oldValue}:F={path:nt,op:"add",value:D.oldValue},D.path.includes("trackItemIds")?b.push(F):D.path.includes("transitionIds")?d.push(F):D.path.includes("trackItemsMap")?_.push(F):D.path.includes("transitionsMap")?T.push(F):D.path.includes("tracks")?y.push(F):D.path.includes("structure")&&E.push(F)});const f=this.applyPatch(m.tracks,y),I=this.applyPatch(m.transitionIds,d),k=this.applyPatch(m.trackItemIds,b),v=this.applyPatch(m.transitionsMap,T),w=this.applyPatch(m.trackItemsMap,_),M=this.applyPatch(m.structure,E),A=C({tracks:f,transitionIds:I,trackItemIds:k,transitionsMap:v,trackItemsMap:w,structure:M}),j=C(this.getState()),P={...j,...A};this.prevState=j,this.redos.push({redos:e,type:n});const Z=K(P.trackItemsMap);this.stateSubject.next({...P,duration:Z}),this.stateHistorySubject.next({handleRedo:!1,handleUndo:!0}),this.updateState(P,{updateHistory:!1})}applyPatch(r,e){return e.reverse().reduce((n,i)=>ro(n,o=>{no(o,[i])}),r)}redo(){const r=this.redos.pop(),e=r==null?void 0:r.redos,n=r==null?void 0:r.type;if(!e||!n)return;pi();const{trackItemIds:i,tracks:o,transitionIds:c,transitionsMap:u,trackItemsMap:p,structure:h}=this.getState(),m=C({trackItemIds:i,tracks:o,transitionIds:c,transitionsMap:u,trackItemsMap:p,structure:h}),y=[],d=[],b=[],T=[],_=[],E=[];e.forEach(D=>{let F;const nt=D.path.slice(1);D.type==="CREATE"?F={path:nt,op:"add",value:D.value}:D.type==="CHANGE"?F={path:nt,op:"replace",value:D.value}:F={path:nt,op:"remove",value:D.oldValue},D.path.includes("trackItemIds")?b.push(F):D.path.includes("transitionIds")?d.push(F):D.path.includes("trackItemsMap")?_.push(F):D.path.includes("transitionsMap")?T.push(F):D.path.includes("structure")?E.push(F):y.push(F)});const f=this.applyPatch(m.tracks,y),I=this.applyPatch(m.transitionIds,d),k=this.applyPatch(m.trackItemIds,b),v=this.applyPatch(m.transitionsMap,T),w=this.applyPatch(m.trackItemsMap,_),M=this.applyPatch(m.structure,E),A=C({tracks:f,transitionIds:I,trackItemIds:k,transitionsMap:v,trackItemsMap:w,structure:M}),j=C(this.getState()),P={...j,...A};this.prevState=j,this.undos.push({undos:e,type:n});const Z=K(P.trackItemsMap);this.stateSubject.next({...P,duration:Z}),this.stateHistorySubject.next({handleRedo:!0,handleUndo:!1}),this.updateState(P,{updateHistory:!1})}toJSON(){const{fps:r,tracks:e,size:n,trackItemIds:i,transitionsMap:o,trackItemsMap:c,transitionIds:u}=this.getState();return{fps:r,tracks:e,size:n,trackItemIds:i,transitionsMap:o,trackItemsMap:c,transitionIds:u}}}S.ACTIVE_CLONE=Ki,S.ACTIVE_DELETE=Xi,S.ACTIVE_PASTE=As,S.ACTIVE_PREFIX=Wt,S.ACTIVE_SET=Gi,S.ACTIVE_SPLIT=ws,S.ADD_ANIMATION=ds,S.ADD_AUDIO=os,S.ADD_CAPTIONS=fs,S.ADD_COMPOSITION=ms,S.ADD_HILL_AUDIO_BARS=ks,S.ADD_ILLUSTRATION=us,S.ADD_IMAGE=cs,S.ADD_ITEMS=hs,S.ADD_LINEAL_AUDIO_BARS=bs,S.ADD_MASK=$i,S.ADD_PLACEHOLDER=Fi,S.ADD_PREFIX=U,S.ADD_PROGRESS_BAR=gs,S.ADD_PROGRESS_FRAME=Is,S.ADD_RADIAL_AUDIO_BARS=ys,S.ADD_RECT=vs,S.ADD_SHAPE=ls,S.ADD_SUFFIX=xi,S.ADD_TEMPLATE=ps,S.ADD_TEXT=is,S.ADD_TRANSITION=Hi,S.ADD_VIDEO=as,S.ADD_WAVE_AUDIO_BARS=_s,S.BULK_PREFIX=rs,S.DELETE_TEMPLATE_ITEM=Yi,S.DESIGN_LOAD=ns,S.DESIGN_PREFIX=dr,S.DESIGN_RESIZE=ss,S.EDIT_BACKGROUND_EDITOR=Ts,S.EDIT_BULK=Fr,S.EDIT_OBJECT=Ss,S.EDIT_PREFIX=Et,S.EDIT_SHAPE=ji,S.EDIT_TEMPLATE_ITEM=Bi,S.EDIT_TEXT=Ui,S.ENTER_EDIT_MODE=Wi,S.HISTORY_PREFIX=Fe,S.HISTORY_REDO=xs,S.HISTORY_RESET=ia,S.HISTORY_UNDO=Ps,S.LAYER_CLONE=Ds,S.LAYER_COPY=Os,S.LAYER_CUT=sa,S.LAYER_DELETE=Rs,S.LAYER_EDITING_NAME=ea,S.LAYER_HIDDEN=Ji,S.LAYER_LOCKED=Vi,S.LAYER_MOVE=qi,S.LAYER_PASTE=ra,S.LAYER_PREFIX=X,S.LAYER_RENAME=ta,S.LAYER_REPLACE=Cs,S.LAYER_SELECT=Ms,S.LAYER_SELECTION=Zi,S.LAYER_SEND_TO=Qi,S.LAYER_SPLIT=na,S.REPLACE_MEDIA=Es,S.STATE_CHANGED=Ni,S.STATE_PREFIX=es,S.TIMELINE_SCALE_CHANGED=Ls,S.TIMELINE_SCALE_PREFIX=$r,S.TRACKS_CHANGED=Li,S.TRACK_ITEMS_CHANGED=zi,S.TRACK_ITEMS_PREFIX=ts,S.TRACK_PREFIX=Qn,S.default=Lo,S.getAcceptsMap=Ns,Object.defineProperties(S,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
